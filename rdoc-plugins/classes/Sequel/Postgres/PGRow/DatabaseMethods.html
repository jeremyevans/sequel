<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Sequel::Postgres::PGRow::DatabaseMethods</title>
    <meta content='text/html; charset=US-ASCII' http-equiv='Content-Type'>
    <link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          Sequel::Postgres::PGRow::DatabaseMethods
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../../files/lib/sequel/extensions/pg_row_rb.html">lib/sequel/extensions/pg_row.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a target="docwin" href="../PGRow.html">PGRow</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'></div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-extended">extended</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#method-i-bound_variable_arg">bound_variable_arg</a></li>
              <li><a target="docwin" href="#method-i-register_row_type">register_row_type</a></li>
              <li><a target="docwin" href="#method-i-reset_conversion_procs">reset_conversion_procs</a></li>
              <li><a target="docwin" href="#method-i-row_type">row_type</a></li>
              <li><a target="docwin" href="#attribute-i-row_types">row_types</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>COMMA</td>
                    <td>=</td>
                    <td class='context-item-value'>','.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>ESCAPE_RE</td>
                    <td>=</td>
                    <td class='context-item-value'>/("|\\)/.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>ESCAPE_REPLACEMENT</td>
                    <td>=</td>
                    <td class='context-item-value'>'\\\\\1'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-row_types'>row_types</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>A hash mapping row type keys (usually symbols), to option hashes.  At the
                      least, the values will contain the :parser option for the <a
                      href="Parser.html">Parser</a> instance that the type will use.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-extended'>
                <a name='method-c-extended'></a>
                <div class='synopsis'>
                  <span class='name'>extended</span>
                  <span class='arguments'>(db)</span>
                </div>
                <div class='description'>
                  
                  <p>Do some setup for the data structures the module uses.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-extended-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-extended-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb, line 386</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extended</span>(<span class="ruby-identifier">db</span>)&#x000A;  <span class="ruby-comment"># Return right away if row_types has already been set. This</span>&#x000A;  <span class="ruby-comment"># makes things not break if a user extends the database with</span>&#x000A;  <span class="ruby-comment"># this module more than once (since extended is called every</span>&#x000A;  <span class="ruby-comment"># time).</span>&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">db</span>.<span class="ruby-identifier">row_types</span>&#x000A;&#x000A;  <span class="ruby-identifier">db</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-ivar">@row_types</span> = {}&#x000A;    <span class="ruby-ivar">@row_schema_types</span> = {}&#x000A;    <span class="ruby-identifier">extend</span>(<span class="ruby-ivar">@row_type_method_module</span> = <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>)&#x000A;    <span class="ruby-identifier">copy_conversion_procs</span>([<span class="ruby-value">2249</span>, <span class="ruby-value">2287</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-bound_variable_arg'>
                <a name='method-i-bound_variable_arg'></a>
                <div class='synopsis'>
                  <span class='name'>bound_variable_arg</span>
                  <span class='arguments'>(arg, conn)</span>
                </div>
                <div class='description'>
                  
                  <p>Handle <a href="ArrayRow.html">ArrayRow</a> and <a
                  href="HashRow.html">HashRow</a> values in bound variables.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-bound_variable_arg-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-bound_variable_arg-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb, line 402</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">bound_variable_arg</span>(<span class="ruby-identifier">arg</span>, <span class="ruby-identifier">conn</span>)&#x000A;  <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">ArrayRow</span>&#x000A;    <span class="ruby-node">&quot;(#{arg.map{|v| bound_variable_array(v) if v}.join(COMMA)})&quot;</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">HashRow</span>&#x000A;    <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">check_columns!</span>&#x000A;    <span class="ruby-node">&quot;(#{arg.values_at(*arg.columns).map{|v| bound_variable_array(v) if v}.join(COMMA)})&quot;</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-keyword">super</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-register_row_type'>
                <a name='method-i-register_row_type'></a>
                <div class='synopsis'>
                  <span class='name'>register_row_type</span>
                  <span class='arguments'>(db_type, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Register a new row type for the <a href="../../Database.html">Database</a>
                  instance. db_type should be the type symbol.  This parses the PostgreSQL
                  system tables to get information the composite type, and by default has the
                  type return instances of a subclass of <a href="HashRow.html">HashRow</a>.</p>
                  
                  <p>The following options are supported:</p>
                  <dl class="rdoc-list note-list"><dt>:converter 
                  <dd>
                  <p>Use a custom converter for the parser.</p>
                  </dd><dt>:typecaster 
                  <dd>
                  <p>Use a custom typecaster for the parser.</p>
                  </dd></dl>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-register_row_type-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-register_row_type-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb, line 423</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">register_row_type</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">procs</span> = <span class="ruby-ivar">@conversion_procs</span>&#x000A;  <span class="ruby-identifier">rel_oid</span> = <span class="ruby-keyword">nil</span>&#x000A;  <span class="ruby-identifier">array_oid</span> = <span class="ruby-keyword">nil</span>&#x000A;  <span class="ruby-identifier">parser_opts</span> = {}&#x000A;&#x000A;  <span class="ruby-comment"># Try to handle schema-qualified types.</span>&#x000A;  <span class="ruby-identifier">type_schema</span>, <span class="ruby-identifier">type_name</span> = <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">db_type</span>)&#x000A;  <span class="ruby-identifier">schema_type_string</span> = <span class="ruby-identifier">type_name</span>.<span class="ruby-identifier">to_s</span>&#x000A;&#x000A;  <span class="ruby-comment"># Get basic oid information for the composite type.</span>&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_type</span>).&#x000A;    <span class="ruby-identifier">select</span>(<span class="ruby-value">:pg_type__oid</span>, <span class="ruby-value">:typrelid</span>, <span class="ruby-value">:typarray</span>).&#x000A;    <span class="ruby-identifier">where</span>([[<span class="ruby-value">:typtype</span>, <span class="ruby-string">&#39;c&#39;</span>], [<span class="ruby-value">:typname</span>, <span class="ruby-identifier">type_name</span>.<span class="ruby-identifier">to_s</span>]])&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">type_schema</span>&#x000A;    <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_namespace</span>, [[<span class="ruby-value">:oid</span>, <span class="ruby-value">:typnamespace</span>], [<span class="ruby-value">:nspname</span>, <span class="ruby-identifier">type_schema</span>.<span class="ruby-identifier">to_s</span>]])&#x000A;    <span class="ruby-identifier">schema_type_symbol</span> = <span class="ruby-value">:&quot;pg_row_#{type_schema}__#{type_name}&quot;</span> &#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">schema_type_symbol</span> = <span class="ruby-value">:&quot;pg_row_#{type_name}&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">row</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">first</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;row type #{db_type.inspect} not found in database&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-comment"># Manually cast to integer using to_i, because adapter may not cast oid type</span>&#x000A;  <span class="ruby-comment"># correctly (e.g. swift)</span>&#x000A;  <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:oid</span>], <span class="ruby-identifier">rel_oid</span>, <span class="ruby-identifier">array_oid</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-value">:oid</span>, <span class="ruby-value">:typrelid</span>, <span class="ruby-value">:typarray</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_i</span>}&#x000A;&#x000A;  <span class="ruby-comment"># Get column names and oids for each of the members of the composite type.</span>&#x000A;  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_attribute</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_type</span>, <span class="ruby-value">:oid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:atttypid</span>).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:attrelid=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">rel_oid</span>).&#x000A;    <span class="ruby-identifier">where</span>{<span class="ruby-identifier">attnum</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>}.&#x000A;    <span class="ruby-identifier">exclude</span>(<span class="ruby-value">:attisdropped</span>).&#x000A;    <span class="ruby-identifier">order</span>(<span class="ruby-value">:attnum</span>).&#x000A;    <span class="ruby-identifier">select_map</span>([<span class="ruby-value">:attname</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">case</span>({<span class="ruby-value">0</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">:atttypid</span>}, <span class="ruby-value">:pg_type__typbasetype</span>, <span class="ruby-value">:pg_type__typbasetype</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:atttypid</span>)])&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">empty?</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;no columns for row type #{db_type.inspect} in database&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:columns</span>] = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_sym</span>}&#x000A;  <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:column_oids</span>] = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>}&#x000A;&#x000A;  <span class="ruby-comment"># Using the conversion_procs, lookup converters for each member of the composite type</span>&#x000A;  <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:column_converters</span>] = <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:column_oids</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">oid</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">pr</span> = <span class="ruby-identifier">procs</span>[<span class="ruby-identifier">oid</span>]&#x000A;      <span class="ruby-identifier">pr</span>&#x000A;    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Postgres</span><span class="ruby-operator">::</span><span class="ruby-constant">STRING_TYPES</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">oid</span>)&#x000A;      <span class="ruby-comment"># It&#39;s not a string type, and it&#39;s possible a conversion proc for this</span>&#x000A;      <span class="ruby-comment"># oid will be added later, so do a runtime check for it.</span>&#x000A;      <span class="ruby-identifier">lambda</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">pr</span> = <span class="ruby-identifier">procs</span>[<span class="ruby-identifier">oid</span>]) <span class="ruby-operator">?</span> <span class="ruby-identifier">pr</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">s</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">s</span>}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-comment"># Setup the converter and typecaster</span>&#x000A;  <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:converter</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:converter</span>){<span class="ruby-constant">HashRow</span>.<span class="ruby-identifier">subclass</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:columns</span>])}&#x000A;  <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:typecaster</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:typecaster</span>, <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:converter</span>])&#x000A;&#x000A;  <span class="ruby-identifier">parser</span> = <span class="ruby-constant">Parser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">parser_opts</span>)&#x000A;  <span class="ruby-ivar">@conversion_procs</span>[<span class="ruby-identifier">parser</span>.<span class="ruby-identifier">oid</span>] = <span class="ruby-identifier">parser</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">PGArray</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">PGArray</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:register</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">array_oid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">array_oid</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;    <span class="ruby-identifier">array_type_name</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">type_schema</span>&#x000A;      <span class="ruby-node">&quot;#{type_schema}.#{type_name}&quot;</span>&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">type_name</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-constant">PGArray</span>.<span class="ruby-identifier">register</span>(<span class="ruby-identifier">array_type_name</span>, <span class="ruby-value">:oid=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">array_oid</span>, <span class="ruby-value">:converter=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">parser</span>, <span class="ruby-value">:type_procs=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@conversion_procs</span>, <span class="ruby-value">:scalar_typecast=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">schema_type_symbol</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-ivar">@row_types</span>[<span class="ruby-identifier">db_type</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:parser=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">parser</span>)&#x000A;  <span class="ruby-ivar">@row_schema_types</span>[<span class="ruby-identifier">schema_type_string</span>] = <span class="ruby-identifier">schema_type_symbol</span> &#x000A;  <span class="ruby-ivar">@schema_type_classes</span>[<span class="ruby-identifier">schema_type_symbol</span>] = <span class="ruby-constant">ROW_TYPE_CLASSES</span>&#x000A;  <span class="ruby-ivar">@row_type_method_module</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-identifier">meth</span> = <span class="ruby-value">:&quot;typecast_value_#{schema_type_symbol}&quot;</span>&#x000A;    <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">meth</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">row_type</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">v</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-identifier">private</span> <span class="ruby-identifier">meth</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">nil</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-reset_conversion_procs'>
                <a name='method-i-reset_conversion_procs'></a>
                <div class='synopsis'>
                  <span class='name'>reset_conversion_procs</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>When reseting conversion procs, reregister all the row types so that the
                  system tables are introspected again, picking up database changes.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-reset_conversion_procs-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-reset_conversion_procs-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb, line 507</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_conversion_procs</span>&#x000A;  <span class="ruby-identifier">procs</span> = <span class="ruby-keyword">super</span>&#x000A;&#x000A;  <span class="ruby-identifier">row_types</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">opts</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">register_row_type</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">procs</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-row_type'>
                <a name='method-i-row_type'></a>
                <div class='synopsis'>
                  <span class='name'>row_type</span>
                  <span class='arguments'>(db_type, obj)</span>
                </div>
                <div class='description'>
                  
                  <p>Handle typecasting of the given object to the given database type. In
                  general, the given database type should already be registered, but if obj
                  is an array, this will handled unregistered types.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-row_type-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-row_type-source'><span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb, line 520</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">row_type</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">obj</span>)&#x000A;  (<span class="ruby-identifier">type_hash</span> = <span class="ruby-ivar">@row_types</span>[<span class="ruby-identifier">db_type</span>]) <span class="ruby-operator">&amp;&amp;</span>&#x000A;    (<span class="ruby-identifier">parser</span> = <span class="ruby-identifier">type_hash</span>[<span class="ruby-value">:parser</span>])&#x000A;&#x000A;  <span class="ruby-keyword">case</span> <span class="ruby-identifier">obj</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">ArrayRow</span>, <span class="ruby-constant">HashRow</span>&#x000A;    <span class="ruby-identifier">obj</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">parser</span>&#x000A;      <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">typecast</span>(<span class="ruby-identifier">obj</span>)&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">obj</span> = <span class="ruby-constant">ArrayRow</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">obj</span>)&#x000A;      <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">db_type</span> = <span class="ruby-identifier">db_type</span>&#x000A;      <span class="ruby-identifier">obj</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">parser</span> &#x000A;      <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">typecast</span>(<span class="ruby-identifier">obj</span>)&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidValue</span>, <span class="ruby-node">&quot;Database#row_type requires the #{db_type.inspect} type have a registered parser and typecaster when called with a hash&quot;</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidValue</span>, <span class="ruby-node">&quot;cannot convert #{obj.inspect} to row type #{db_type.inspect}&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
