<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Sequel::Postgres::DatabaseMethods</title>
    <meta content='text/html; charset=US-ASCII' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          Sequel::Postgres::DatabaseMethods
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../files/lib/sequel/adapters/shared/postgres_rb.html">lib/sequel/adapters/shared/postgres.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a target="docwin" href="../Postgres.html">Postgres</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>Methods shared by <a href="Database.html">Database</a> instances that
            connect to PostgreSQL.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#method-i-commit_prepared_transaction">commit_prepared_transaction</a></li>
              <li><a target="docwin" href="#attribute-i-conversion_procs">conversion_procs</a></li>
              <li><a target="docwin" href="#method-i-create_function">create_function</a></li>
              <li><a target="docwin" href="#method-i-create_language">create_language</a></li>
              <li><a target="docwin" href="#method-i-create_schema">create_schema</a></li>
              <li><a target="docwin" href="#method-i-create_trigger">create_trigger</a></li>
              <li><a target="docwin" href="#method-i-database_type">database_type</a></li>
              <li><a target="docwin" href="#method-i-do">do</a></li>
              <li><a target="docwin" href="#method-i-drop_function">drop_function</a></li>
              <li><a target="docwin" href="#method-i-drop_language">drop_language</a></li>
              <li><a target="docwin" href="#method-i-drop_schema">drop_schema</a></li>
              <li><a target="docwin" href="#method-i-drop_trigger">drop_trigger</a></li>
              <li><a target="docwin" href="#method-i-foreign_key_list">foreign_key_list</a></li>
              <li><a target="docwin" href="#method-i-indexes">indexes</a></li>
              <li><a target="docwin" href="#method-i-locks">locks</a></li>
              <li><a target="docwin" href="#method-i-notify">notify</a></li>
              <li><a target="docwin" href="#method-i-primary_key">primary_key</a></li>
              <li><a target="docwin" href="#method-i-primary_key_sequence">primary_key_sequence</a></li>
              <li><a target="docwin" href="#method-i-refresh_view">refresh_view</a></li>
              <li><a target="docwin" href="#method-i-reset_conversion_procs">reset_conversion_procs</a></li>
              <li><a target="docwin" href="#method-i-reset_primary_key_sequence">reset_primary_key_sequence</a></li>
              <li><a target="docwin" href="#method-i-rollback_prepared_transaction">rollback_prepared_transaction</a></li>
              <li><a target="docwin" href="#method-i-serial_primary_key_options">serial_primary_key_options</a></li>
              <li><a target="docwin" href="#method-i-server_version">server_version</a></li>
              <li><a target="docwin" href="#method-i-supports_create_table_if_not_exists-3F">supports_create_table_if_not_exists?</a></li>
              <li><a target="docwin" href="#method-i-supports_deferrable_constraints-3F">supports_deferrable_constraints?</a></li>
              <li><a target="docwin" href="#method-i-supports_deferrable_foreign_key_constraints-3F">supports_deferrable_foreign_key_constraints?</a></li>
              <li><a target="docwin" href="#method-i-supports_drop_table_if_exists-3F">supports_drop_table_if_exists?</a></li>
              <li><a target="docwin" href="#method-i-supports_partial_indexes-3F">supports_partial_indexes?</a></li>
              <li><a target="docwin" href="#method-i-supports_prepared_transactions-3F">supports_prepared_transactions?</a></li>
              <li><a target="docwin" href="#method-i-supports_savepoints-3F">supports_savepoints?</a></li>
              <li><a target="docwin" href="#method-i-supports_transaction_isolation_levels-3F">supports_transaction_isolation_levels?</a></li>
              <li><a target="docwin" href="#method-i-supports_transactional_ddl-3F">supports_transactional_ddl?</a></li>
              <li><a target="docwin" href="#method-i-tables">tables</a></li>
              <li><a target="docwin" href="#method-i-type_supported-3F">type_supported?</a></li>
              <li><a target="docwin" href="#method-i-views">views</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DATABASE_ERROR_REGEXPS</td>
                    <td>=</td>
                    <td class='context-item-value'>
                      [
                      # Add this check first, since otherwise it's possible for users to control
                      # which exception class is generated.
                      [/invalid input syntax/, DatabaseError],
                      [/duplicate key value violates unique constraint/, UniqueConstraintViolation],
                      [/violates foreign key constraint/, ForeignKeyConstraintViolation],
                      [/violates check constraint/, CheckConstraintViolation],
                      [/violates not-null constraint/, NotNullConstraintViolation],
                      [/conflicting key value violates exclusion constraint/, ExclusionConstraintViolation],
                      [/could not serialize access/, SerializationFailure],
                      ].freeze
                    </td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>EXCLUSION_CONSTRAINT_SQL_STATE</td>
                    <td>=</td>
                    <td class='context-item-value'>'23P01'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>FOREIGN_KEY_LIST_ON_DELETE_MAP</td>
                    <td>=</td>
                    <td class='context-item-value'>{'a'.freeze=>:no_action, 'r'.freeze=>:restrict, 'c'.freeze=>:cascade, 'n'.freeze=>:set_null, 'd'.freeze=>:set_default}.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>ON_COMMIT</td>
                    <td>=</td>
                    <td class='context-item-value'>
                      {
                      :drop => 'DROP', :delete_rows => 'DELETE ROWS', :preserve_rows => 'PRESERVE ROWS',
                      }.freeze
                    </td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>POSTGRES_DEFAULT_RE</td>
                    <td>=</td>
                    <td class='context-item-value'>/\A(?:B?('.*')::[^']+|\((-?\d+(?:\.\d+)?)\))\z/</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>PREPARED_ARG_PLACEHOLDER</td>
                    <td>=</td>
                    <td class='context-item-value'>LiteralString.new('$').freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>RE_CURRVAL_ERROR</td>
                    <td>=</td>
                    <td class='context-item-value'>/currval of sequence "(.*)" is not yet defined in this session|relation "(.*)" does not exist/.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>SELECT_CUSTOM_SEQUENCE_SQL</td>
                    <td>=</td>
                    <td class='context-item-value'>
                      (<<-end_sql
                      SELECT name.nspname AS "schema",
                      CASE
                      WHEN split_part(def.adsrc, '''', 2) ~ '.' THEN
                      substr(split_part(def.adsrc, '''', 2),
                      strpos(split_part(def.adsrc, '''', 2), '.')+1)
                      ELSE split_part(def.adsrc, '''', 2)
                      END AS "sequence"
                      FROM pg_class t
                      JOIN pg_namespace  name ON (t.relnamespace = name.oid)
                      JOIN pg_attribute  attr ON (t.oid = attrelid)
                      JOIN pg_attrdef    def  ON (adrelid = attrelid AND adnum = attnum)
                      JOIN pg_constraint cons ON (conrelid = adrelid AND adnum = conkey[1])
                      WHERE cons.contype = 'p'
                      AND def.adsrc ~* 'nextval'
                      end_sql
                      ).strip.gsub(/\s+/, ' ').freeze
                    </td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>SQL fragment for custom sequences (ones not created by serial primary key),
                      Returning the schema and literal form of the sequence name, by parsing the
                      column defaults table.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>SELECT_PK_SQL</td>
                    <td>=</td>
                    <td class='context-item-value'>
                      (<<-end_sql
                      SELECT pg_attribute.attname AS pk
                      FROM pg_class, pg_attribute, pg_index, pg_namespace
                      WHERE pg_class.oid = pg_attribute.attrelid
                      AND pg_class.relnamespace  = pg_namespace.oid
                      AND pg_class.oid = pg_index.indrelid
                      AND pg_index.indkey[0] = pg_attribute.attnum
                      AND pg_index.indisprimary = 't'
                      end_sql
                      ).strip.gsub(/\s+/, ' ').freeze
                    </td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>SQL fragment for determining primary key column for the given table.  Only
                      returns the first primary key if the table has a composite primary key.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>SELECT_SERIAL_SEQUENCE_SQL</td>
                    <td>=</td>
                    <td class='context-item-value'>
                      (<<-end_sql
                      SELECT  name.nspname AS "schema", seq.relname AS "sequence"
                      FROM pg_class seq, pg_attribute attr, pg_depend dep,
                      pg_namespace name, pg_constraint cons, pg_class t
                      WHERE seq.oid = dep.objid
                      AND seq.relnamespace  = name.oid
                      AND seq.relkind = 'S'
                      AND attr.attrelid = dep.refobjid
                      AND attr.attnum = dep.refobjsubid
                      AND attr.attrelid = cons.conrelid
                      AND attr.attnum = cons.conkey[1]
                      AND attr.attrelid = t.oid
                      AND cons.contype = 'p'
                      end_sql
                      ).strip.gsub(/\s+/, ' ').freeze
                    </td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>SQL fragment for getting sequence associated with table&#39;s primary key,
                      assuming it was a serial primary key column.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>UNLOGGED</td>
                    <td>=</td>
                    <td class='context-item-value'>'UNLOGGED '.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>VALID_CLIENT_MIN_MESSAGES</td>
                    <td>=</td>
                    <td class='context-item-value'>%w'DEBUG5 DEBUG4 DEBUG3 DEBUG2 DEBUG1 LOG NOTICE WARNING ERROR FATAL PANIC'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-conversion_procs'>conversion_procs</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>A hash of conversion procs, keyed by type integer (oid) and having callable
                      values for the conversion proc for that type.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-commit_prepared_transaction'>
                <a name='method-i-commit_prepared_transaction'></a>
                <div class='synopsis'>
                  <span class='name'>commit_prepared_transaction</span>
                  <span class='arguments'>(transaction_id, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Commit an existing prepared transaction with the given transaction
                  identifier string.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-commit_prepared_transaction-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-commit_prepared_transaction-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 159</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">commit_prepared_transaction</span>(<span class="ruby-identifier">transaction_id</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">run</span>(<span class="ruby-node">&quot;COMMIT PREPARED #{literal(transaction_id)}&quot;</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-create_function'>
                <a name='method-i-create_function'></a>
                <div class='synopsis'>
                  <span class='name'>create_function</span>
                  <span class='arguments'>(name, definition, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Creates the function in the database.  Arguments:</p>
                  <ul><li>
                  <p>name : name of the function to create</p>
                  </li><li>
                  <p>definition : string definition of the function, or object file for a
                  dynamically loaded C function.</p>
                  </li><li>
                  <p>opts : options hash:</p>
                  <ul><li>
                  <p>:args : function arguments, can be either a symbol or string specifying a
                  type or an array of 1-3 elements:</p>
                  <ul><li>
                  <p>element 1 : argument data type</p>
                  </li><li>
                  <p>element 2 : argument name</p>
                  </li><li>
                  <p>element 3 : argument mode (e.g. in, out, inout)</p>
                  </li></ul>
                  </li><li>
                  <p>:behavior : Should be IMMUTABLE, STABLE, or VOLATILE.  PostgreSQL assumes
                  VOLATILE by default.</p>
                  </li><li>
                  <p>:cost : The estimated cost of the function, used by the query planner.</p>
                  </li><li>
                  <p>:language : The language the function uses.  SQL is the default.</p>
                  </li><li>
                  <p>:link_symbol : For a dynamically loaded see function, the function&#39;s
                  link symbol if different from the definition argument.</p>
                  </li><li>
                  <p>:returns : The data type returned by the function.  If you are using OUT or
                  INOUT argument modes, this is ignored. Otherwise, if this is not specified,
                  void is used by default to specify the function is not supposed to return a
                  value.</p>
                  </li><li>
                  <p>:rows : The estimated number of rows the function will return.  Only use if
                  the function returns SETOF something.</p>
                  </li><li>
                  <p>:security_definer : Makes the privileges of the function the same as the
                  privileges of the user who defined the function instead of the privileges
                  of the user who runs the function.  There are security implications when
                  doing this, see the PostgreSQL documentation.</p>
                  </li><li>
                  <p>:set : Configuration variables to set while the function is being run, can
                  be a hash or an array of two pairs.  search_path is often used here if
                  :security_definer is used.</p>
                  </li><li>
                  <p>:strict : Makes the function return NULL when any argument is NULL.</p>
                  </li></ul>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-create_function-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-create_function-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 183</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_function</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">definition</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_function_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">definition</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-create_language'>
                <a name='method-i-create_language'></a>
                <div class='synopsis'>
                  <span class='name'>create_language</span>
                  <span class='arguments'>(name, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Create the procedural language in the database. Arguments:</p>
                  <ul><li>
                  <p>name : Name of the procedural language (e.g. plpgsql)</p>
                  </li><li>
                  <p>opts : options hash:</p>
                  <ul><li>
                  <p>:handler : The name of a previously registered function used as a call
                  handler for this language.</p>
                  </li><li>
                  <p>:replace : Replace the installed language if it already exists (on
                  PostgreSQL 9.0+).</p>
                  </li><li>
                  <p>:trusted : Marks the language being created as trusted, allowing
                  unprivileged users to create functions using this language.</p>
                  </li><li>
                  <p>:validator : The name of previously registered function used as a validator
                  of functions defined in this language.</p>
                  </li></ul>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-create_language-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-create_language-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 194</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_language</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_language_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-create_schema'>
                <a name='method-i-create_schema'></a>
                <div class='synopsis'>
                  <span class='name'>create_schema</span>
                  <span class='arguments'>(name, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Create a schema in the database. Arguments:</p>
                  <ul><li>
                  <p>name : Name of the schema (e.g. admin)</p>
                  </li><li>
                  <p>opts : options hash:</p>
                  <ul><li>
                  <p>:if_not_exists : Don&#39;t raise an error if the schema already exists
                  (PostgreSQL 9.3+)</p>
                  </li><li>
                  <p>:owner : The owner to set for the schema (defaults to current user if not
                  specified)</p>
                  </li></ul>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-create_schema-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-create_schema-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 203</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_schema</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_schema_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-create_trigger'>
                <a name='method-i-create_trigger'></a>
                <div class='synopsis'>
                  <span class='name'>create_trigger</span>
                  <span class='arguments'>(table, name, function, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Create a trigger in the database.  Arguments:</p>
                  <ul><li>
                  <p>table : the table on which this trigger operates</p>
                  </li><li>
                  <p>name : the name of this trigger</p>
                  </li><li>
                  <p>function : the function to call for this trigger, which should return type
                  trigger.</p>
                  </li><li>
                  <p>opts : options hash:</p>
                  <ul><li>
                  <p>:after : Calls the trigger after execution instead of before.</p>
                  </li><li>
                  <p>:args : An argument or array of arguments to pass to the function.</p>
                  </li><li>
                  <p>:each_row : Calls the trigger for each row instead of for each statement.</p>
                  </li><li>
                  <p>:events : Can be :insert, :update, :delete, or an array of any of those.
                  Calls the trigger whenever that type of statement is used.  By default, the
                  trigger is called for insert, update, or delete.</p>
                  </li></ul>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-create_trigger-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-create_trigger-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 217</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_trigger</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">function</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_trigger_sql</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">function</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-database_type'>
                <a name='method-i-database_type'></a>
                <div class='synopsis'>
                  <span class='name'>database_type</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL uses the :postgres database type.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-database_type-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-database_type-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 222</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">database_type</span>&#x000A;  <span class="ruby-value">:postgres</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-do'>
                <a name='method-i-do'></a>
                <div class='synopsis'>
                  <span class='name'>do</span>
                  <span class='arguments'>(code, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Use PostgreSQL&#39;s DO syntax to execute an anonymous code block.  The
                  code should be the literal code string to use in the underlying procedural
                  language.  Options:</p>
                  <dl class="rdoc-list note-list"><dt>:language 
                  <dd>
                  <p>The procedural language the code is written in.  The PostgreSQL default is
                  plpgsql.  Can be specified as a string or a symbol.</p>
                  </dd></dl>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-do-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-do-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 231</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">do</span>(<span class="ruby-identifier">code</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">language</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:language</span>]&#x000A;  <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;DO #{&quot;LANGUAGE #{literal(language.to_s)} &quot; if language}#{literal(code)}&quot;</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-drop_function'>
                <a name='method-i-drop_function'></a>
                <div class='synopsis'>
                  <span class='name'>drop_function</span>
                  <span class='arguments'>(name, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Drops the function from the database. Arguments:</p>
                  <ul><li>
                  <p>name : name of the function to drop</p>
                  </li><li>
                  <p>opts : options hash:</p>
                  <ul><li>
                  <p>:args : The arguments for the function.  See create_function_sql.</p>
                  </li><li>
                  <p>:cascade : Drop other objects depending on this function.</p>
                  </li><li>
                  <p>:if_exists : Don&#39;t raise an error if the function doesn&#39;t exist.</p>
                  </li></ul>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-drop_function-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-drop_function-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 242</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">drop_function</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_function_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-drop_language'>
                <a name='method-i-drop_language'></a>
                <div class='synopsis'>
                  <span class='name'>drop_language</span>
                  <span class='arguments'>(name, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Drops a procedural language from the database.  Arguments:</p>
                  <ul><li>
                  <p>name : name of the procedural language to drop</p>
                  </li><li>
                  <p>opts : options hash:</p>
                  <ul><li>
                  <p>:cascade : Drop other objects depending on this function.</p>
                  </li><li>
                  <p>:if_exists : Don&#39;t raise an error if the function doesn&#39;t exist.</p>
                  </li></ul>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-drop_language-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-drop_language-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 251</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">drop_language</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_language_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-drop_schema'>
                <a name='method-i-drop_schema'></a>
                <div class='synopsis'>
                  <span class='name'>drop_schema</span>
                  <span class='arguments'>(name, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Drops a schema from the database.  Arguments:</p>
                  <ul><li>
                  <p>name : name of the schema to drop</p>
                  </li><li>
                  <p>opts : options hash:</p>
                  <ul><li>
                  <p>:cascade : Drop all objects in this schema.</p>
                  </li><li>
                  <p>:if_exists : Don&#39;t raise an error if the schema doesn&#39;t exist.</p>
                  </li></ul>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-drop_schema-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-drop_schema-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 260</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">drop_schema</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_schema_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-drop_trigger'>
                <a name='method-i-drop_trigger'></a>
                <div class='synopsis'>
                  <span class='name'>drop_trigger</span>
                  <span class='arguments'>(table, name, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Drops a trigger from the database.  Arguments:</p>
                  <ul><li>
                  <p>table : table from which to drop the trigger</p>
                  </li><li>
                  <p>name : name of the trigger to drop</p>
                  </li><li>
                  <p>opts : options hash:</p>
                  <ul><li>
                  <p>:cascade : Drop other objects depending on this function.</p>
                  </li><li>
                  <p>:if_exists : Don&#39;t raise an error if the function doesn&#39;t exist.</p>
                  </li></ul>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-drop_trigger-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-drop_trigger-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 270</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">drop_trigger</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_trigger_sql</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-foreign_key_list'>
                <a name='method-i-foreign_key_list'></a>
                <div class='synopsis'>
                  <span class='name'>foreign_key_list</span>
                  <span class='arguments'>(table, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Return full foreign key information using the pg system tables, including
                  :name, :on_delete, :on_update, and :deferrable entries in the hashes.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-foreign_key_list-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-foreign_key_list-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 276</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">foreign_key_list</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>&#x000A;  <span class="ruby-identifier">schema</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:schema</span>, <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table</span>))&#x000A;  <span class="ruby-identifier">range</span> = <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">32</span>&#x000A;&#x000A;  <span class="ruby-identifier">base_ds</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_constraint___co</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_class___cl</span>, <span class="ruby-value">:oid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:conrelid</span>).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:cl__relkind=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;r&#39;</span>, <span class="ruby-value">:co__contype=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;f&#39;</span>, <span class="ruby-value">:cl__oid=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>))&#x000A;&#x000A;  <span class="ruby-comment"># We split the parsing into two separate queries, which are merged manually later.</span>&#x000A;  <span class="ruby-comment"># This is because PostgreSQL stores both the referencing and referenced columns in</span>&#x000A;  <span class="ruby-comment"># arrays, and I don&#39;t know a simple way to not create a cross product, as PostgreSQL</span>&#x000A;  <span class="ruby-comment"># doesn&#39;t appear to have a function that takes an array and element and gives you</span>&#x000A;  <span class="ruby-comment"># the index of that element in the array.</span>&#x000A;&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">base_ds</span>.&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_attribute___att</span>, <span class="ruby-value">:attrelid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:oid</span>, <span class="ruby-value">:attnum=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-value">:co__conkey</span>)).&#x000A;    <span class="ruby-identifier">order</span>(<span class="ruby-value">:co__conname</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:co__conkey</span>, [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-value">:att__attnum</span>)).&#x000A;    <span class="ruby-identifier">select</span>(<span class="ruby-value">:co__conname___name</span>, <span class="ruby-value">:att__attname___column</span>, <span class="ruby-value">:co__confupdtype___on_update</span>, <span class="ruby-value">:co__confdeltype___on_delete</span>,&#x000A;           <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:AND</span>, <span class="ruby-value">:co__condeferrable</span>, <span class="ruby-value">:co__condeferred</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:deferrable</span>))&#x000A;&#x000A;  <span class="ruby-identifier">ref_ds</span> = <span class="ruby-identifier">base_ds</span>.&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_class___cl2</span>, <span class="ruby-value">:oid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:co__confrelid</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_attribute___att2</span>, <span class="ruby-value">:attrelid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:oid</span>, <span class="ruby-value">:attnum=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-value">:co__confkey</span>)).&#x000A;    <span class="ruby-identifier">order</span>(<span class="ruby-value">:co__conname</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:co__conkey</span>, [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-value">:att2__attnum</span>)).&#x000A;    <span class="ruby-identifier">select</span>(<span class="ruby-value">:co__conname___name</span>, <span class="ruby-value">:cl2__relname___table</span>, <span class="ruby-value">:att2__attname___refcolumn</span>)&#x000A;&#x000A;  <span class="ruby-comment"># If a schema is given, we only search in that schema, and the returned :table</span>&#x000A;  <span class="ruby-comment"># entry is schema qualified as well.</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">schema</span>&#x000A;    <span class="ruby-identifier">ref_ds</span> = <span class="ruby-identifier">ref_ds</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_namespace___nsp2</span>, <span class="ruby-value">:oid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:cl2__relnamespace</span>).&#x000A;      <span class="ruby-identifier">select_more</span>(<span class="ruby-value">:nsp2__nspname___schema</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">h</span> = {}&#x000A;  <span class="ruby-identifier">fklod_map</span> = <span class="ruby-constant">FOREIGN_KEY_LIST_ON_DELETE_MAP</span> &#x000A;  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span> = <span class="ruby-identifier">h</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]]&#x000A;      <span class="ruby-identifier">r</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">h</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]] = {<span class="ruby-value">:name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]), <span class="ruby-value">:columns=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])], <span class="ruby-value">:on_update=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">fklod_map</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:on_update</span>]], <span class="ruby-value">:on_delete=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">fklod_map</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:on_delete</span>]], <span class="ruby-value">:deferrable=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">row</span>[<span class="ruby-value">:deferrable</span>]}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">ref_ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">r</span> = <span class="ruby-identifier">h</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]]&#x000A;    <span class="ruby-identifier">r</span>[<span class="ruby-value">:table</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">schema</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:schema</span>]), <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>])) <span class="ruby-operator">:</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>])&#x000A;    <span class="ruby-identifier">r</span>[<span class="ruby-value">:key</span>] <span class="ruby-operator">||=</span> []&#x000A;    <span class="ruby-identifier">r</span>[<span class="ruby-value">:key</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:refcolumn</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">h</span>.<span class="ruby-identifier">values</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-indexes'>
                <a name='method-i-indexes'></a>
                <div class='synopsis'>
                  <span class='name'>indexes</span>
                  <span class='arguments'>(table, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Use the pg_* system tables to determine indexes on a table</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-indexes-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-indexes-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 330</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">indexes</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>&#x000A;  <span class="ruby-identifier">range</span> = <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">32</span>&#x000A;  <span class="ruby-identifier">attnums</span> = <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">80100</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-value">:ind__indkey</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ind__indkey</span>, [<span class="ruby-identifier">x</span>])}&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_class___tab</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_index___ind</span>, <span class="ruby-value">:indrelid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:oid</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_class___indc</span>, <span class="ruby-value">:oid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:indexrelid</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_attribute___att</span>, <span class="ruby-value">:attrelid=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:tab__oid</span>, <span class="ruby-value">:attnum=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">attnums</span>).&#x000A;    <span class="ruby-identifier">left_join</span>(<span class="ruby-value">:pg_constraint___con</span>, <span class="ruby-value">:conname=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:indc__relname</span>).&#x000A;    <span class="ruby-identifier">filter</span>(<span class="ruby-value">:indc__relkind=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;i&#39;</span>, <span class="ruby-value">:ind__indisprimary=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>, <span class="ruby-value">:indexprs=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">nil</span>, <span class="ruby-value">:indpred=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">nil</span>, <span class="ruby-value">:indisvalid=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:tab__oid=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>)).&#x000A;    <span class="ruby-identifier">order</span>(<span class="ruby-value">:indc__relname</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ind__indkey</span>, [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-value">:att__attnum</span>)).&#x000A;    <span class="ruby-identifier">select</span>(<span class="ruby-value">:indc__relname___name</span>, <span class="ruby-value">:ind__indisunique___unique</span>, <span class="ruby-value">:att__attname___column</span>, <span class="ruby-value">:con__condeferrable___deferrable</span>)&#x000A;&#x000A;  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">filter!</span>(<span class="ruby-value">:indisready=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:indcheckxmin=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">80300</span>&#x000A;&#x000A;  <span class="ruby-identifier">indexes</span> = {}&#x000A;  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">i</span> = <span class="ruby-identifier">indexes</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:name</span>])] <span class="ruby-operator">||=</span> {<span class="ruby-value">:columns=</span><span class="ruby-operator">&gt;</span>[], <span class="ruby-value">:unique=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">r</span>[<span class="ruby-value">:unique</span>], <span class="ruby-value">:deferrable=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">r</span>[<span class="ruby-value">:deferrable</span>]}&#x000A;    <span class="ruby-identifier">i</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:column</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">indexes</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-locks'>
                <a name='method-i-locks'></a>
                <div class='synopsis'>
                  <span class='name'>locks</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p><a href="Dataset.html">Dataset</a> containing all current database locks</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-locks-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-locks-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 355</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">locks</span>&#x000A;  <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_class</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_locks</span>, <span class="ruby-value">:relation=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:relfilenode</span>).<span class="ruby-identifier">select</span>(<span class="ruby-value">:pg_class__relname</span>, <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">ColumnAll</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:pg_locks</span>))&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-notify'>
                <a name='method-i-notify'></a>
                <div class='synopsis'>
                  <span class='name'>notify</span>
                  <span class='arguments'>(channel, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Notifies the given channel.  See the PostgreSQL NOTIFY documentation.
                  Options:</p>
                  <dl class="rdoc-list note-list"><dt>:payload 
                  <dd>
                  <p>The payload string to use for the NOTIFY statement.  Only supported in
                  PostgreSQL 9.0+.</p>
                  </dd><dt>:server 
                  <dd>
                  <p>The server to which to send the NOTIFY statement, if the sharding support
                  is being used.</p>
                  </dd></dl>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-notify-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-notify-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 365</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">notify</span>(<span class="ruby-identifier">channel</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">sql</span> = <span class="ruby-string">&quot;NOTIFY &quot;</span>&#x000A;  <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:identifier_append</span>, <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">channel</span>)&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">payload</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:payload</span>]&#x000A;    <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;, &quot;</span>&#x000A;    <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">to_s</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">execute_ddl</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-primary_key'>
                <a name='method-i-primary_key'></a>
                <div class='synopsis'>
                  <span class='name'>primary_key</span>
                  <span class='arguments'>(table, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Return primary key for the given table.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-primary_key-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-primary_key-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 376</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">primary_key</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">quoted_table</span> = <span class="ruby-identifier">quote_schema_table</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@primary_keys</span>[<span class="ruby-identifier">quoted_table</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@primary_keys</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">quoted_table</span>)}&#x000A;  <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_PK_SQL} AND pg_class.oid = #{literal(regclass_oid(table, opts))}&quot;</span>&#x000A;  <span class="ruby-identifier">value</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_value</span>&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_keys</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-primary_key_sequence'>
                <a name='method-i-primary_key_sequence'></a>
                <div class='synopsis'>
                  <span class='name'>primary_key_sequence</span>
                  <span class='arguments'>(table, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Return the sequence providing the default for the primary key for the given
                  table.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-primary_key_sequence-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-primary_key_sequence-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 385</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">primary_key_sequence</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">quoted_table</span> = <span class="ruby-identifier">quote_schema_table</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@primary_key_sequences</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">quoted_table</span>)}&#x000A;  <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_SERIAL_SEQUENCE_SQL} AND t.oid = #{literal(regclass_oid(table, opts))}&quot;</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pks</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_record</span>&#x000A;    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">literal</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:schema</span>], <span class="ruby-identifier">pks</span>[<span class="ruby-value">:sequence</span>]))&#x000A;    <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_CUSTOM_SEQUENCE_SQL} AND t.oid = #{literal(regclass_oid(table, opts))}&quot;</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">pks</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_record</span>&#x000A;      <span class="ruby-identifier">value</span> = <span class="ruby-identifier">literal</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:schema</span>], <span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:sequence</span>])))&#x000A;      <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-refresh_view'>
                <a name='method-i-refresh_view'></a>
                <div class='synopsis'>
                  <span class='name'>refresh_view</span>
                  <span class='arguments'>(name, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Refresh the materialized view with the given name.</p>
                  
                  <pre>DB.refresh_view(:items_view)&#x000A;# REFRESH MATERIALIZED VIEW items_view</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-refresh_view-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-refresh_view-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 405</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">refresh_view</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;REFRESH MATERIALIZED VIEW #{quote_schema_table(name)}&quot;</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-reset_conversion_procs'>
                <a name='method-i-reset_conversion_procs'></a>
                <div class='synopsis'>
                  <span class='name'>reset_conversion_procs</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Reset the database&#39;s conversion procs, requires a server query if there
                  any named types.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-reset_conversion_procs-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-reset_conversion_procs-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 411</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_conversion_procs</span>&#x000A;  <span class="ruby-ivar">@conversion_procs</span> = <span class="ruby-identifier">get_conversion_procs</span>&#x000A;  <span class="ruby-identifier">conversion_procs_updated</span>&#x000A;  <span class="ruby-ivar">@conversion_procs</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-reset_primary_key_sequence'>
                <a name='method-i-reset_primary_key_sequence'></a>
                <div class='synopsis'>
                  <span class='name'>reset_primary_key_sequence</span>
                  <span class='arguments'>(table)</span>
                </div>
                <div class='description'>
                  
                  <p>Reset the primary key sequence for the given table, basing it on the
                  maximum current value of the table&#39;s primary key.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-reset_primary_key_sequence-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-reset_primary_key_sequence-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 419</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_primary_key_sequence</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">seq</span> = <span class="ruby-identifier">primary_key_sequence</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-identifier">pk</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">primary_key</span>(<span class="ruby-identifier">table</span>))&#x000A;  <span class="ruby-identifier">db</span> = <span class="ruby-keyword">self</span>&#x000A;  <span class="ruby-identifier">seq_ds</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">from</span>(<span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">seq</span>))&#x000A;  <span class="ruby-identifier">s</span>, <span class="ruby-identifier">t</span> = <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-identifier">table</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">t</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>&#x000A;  <span class="ruby-identifier">get</span>{<span class="ruby-identifier">setval</span>(<span class="ruby-identifier">seq</span>, <span class="ruby-identifier">db</span>[<span class="ruby-identifier">table</span>].<span class="ruby-identifier">select</span>{<span class="ruby-identifier">coalesce</span>(<span class="ruby-identifier">max</span>(<span class="ruby-identifier">pk</span>)<span class="ruby-operator">+</span><span class="ruby-identifier">seq_ds</span>.<span class="ruby-identifier">select</span>{<span class="ruby-value">:increment_by</span>}, <span class="ruby-identifier">seq_ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-value">:min_value</span>))}, <span class="ruby-keyword">false</span>)}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-rollback_prepared_transaction'>
                <a name='method-i-rollback_prepared_transaction'></a>
                <div class='synopsis'>
                  <span class='name'>rollback_prepared_transaction</span>
                  <span class='arguments'>(transaction_id, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Rollback an existing prepared transaction with the given transaction
                  identifier string.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-rollback_prepared_transaction-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-rollback_prepared_transaction-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 431</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">rollback_prepared_transaction</span>(<span class="ruby-identifier">transaction_id</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">run</span>(<span class="ruby-node">&quot;ROLLBACK PREPARED #{literal(transaction_id)}&quot;</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-serial_primary_key_options'>
                <a name='method-i-serial_primary_key_options'></a>
                <div class='synopsis'>
                  <span class='name'>serial_primary_key_options</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL uses SERIAL psuedo-type instead of AUTOINCREMENT for managing
                  incrementing primary keys.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-serial_primary_key_options-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-serial_primary_key_options-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 437</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">serial_primary_key_options</span>&#x000A;  {<span class="ruby-value">:primary_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:serial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:type=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Integer</span>}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-server_version'>
                <a name='method-i-server_version'></a>
                <div class='synopsis'>
                  <span class='name'>server_version</span>
                  <span class='arguments'>(server=nil)</span>
                </div>
                <div class='description'>
                  
                  <p>The version of the PostgreSQL server, used for determining capability.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-server_version-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-server_version-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 442</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">server_version</span>(<span class="ruby-identifier">server</span>=<span class="ruby-keyword">nil</span>)&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@server_version</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@server_version</span>&#x000A;  <span class="ruby-ivar">@server_version</span> = <span class="ruby-identifier">synchronize</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>&#x000A;    (<span class="ruby-identifier">conn</span>.<span class="ruby-identifier">server_version</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:server_version</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@server_version</span>&#x000A;    <span class="ruby-ivar">@server_version</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> = <span class="ruby-regexp">/PostgreSQL (\d+)\.(\d+)(?:(?:rc\d+)|\.(\d+))?/</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;SELECT version()&#39;</span>).<span class="ruby-identifier">single_value</span>)&#x000A;      (<span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">10000</span>) <span class="ruby-operator">+</span> (<span class="ruby-identifier">m</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">3</span>].<span class="ruby-identifier">to_i</span>&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-value">0</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">warn</span> <span class="ruby-string">&#39;Sequel no longer supports PostgreSQL &lt;8.2, some things may not work&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@server_version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">80200</span>&#x000A;  <span class="ruby-ivar">@server_version</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_create_table_if_not_exists-3F'>
                <a name='method-i-supports_create_table_if_not_exists-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_create_table_if_not_exists?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL supports CREATE TABLE IF NOT EXISTS on 9.1+</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_create_table_if_not_exists-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_create_table_if_not_exists-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 459</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_create_table_if_not_exists?</span>&#x000A;  <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90100</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_deferrable_constraints-3F'>
                <a name='method-i-supports_deferrable_constraints-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_deferrable_constraints?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL 9.0+ supports some types of deferrable constraints beyond
                  foreign key constraints.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_deferrable_constraints-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_deferrable_constraints-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 464</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_deferrable_constraints?</span>&#x000A;  <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90000</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_deferrable_foreign_key_constraints-3F'>
                <a name='method-i-supports_deferrable_foreign_key_constraints-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_deferrable_foreign_key_constraints?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL supports deferrable foreign key constraints.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_deferrable_foreign_key_constraints-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_deferrable_foreign_key_constraints-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 469</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_deferrable_foreign_key_constraints?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_drop_table_if_exists-3F'>
                <a name='method-i-supports_drop_table_if_exists-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_drop_table_if_exists?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL supports DROP TABLE IF EXISTS</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_drop_table_if_exists-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_drop_table_if_exists-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 474</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_drop_table_if_exists?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_partial_indexes-3F'>
                <a name='method-i-supports_partial_indexes-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_partial_indexes?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL supports partial indexes.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_partial_indexes-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_partial_indexes-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 479</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_partial_indexes?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_prepared_transactions-3F'>
                <a name='method-i-supports_prepared_transactions-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_prepared_transactions?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL supports prepared transactions (two-phase commit) if
                  max_prepared_transactions is greater than 0.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_prepared_transactions-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_prepared_transactions-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 485</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_prepared_transactions?</span>&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@supports_prepared_transactions</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@supports_prepared_transactions</span>)&#x000A;  <span class="ruby-ivar">@supports_prepared_transactions</span> = <span class="ruby-keyword">self</span>[<span class="ruby-string">&#39;SHOW max_prepared_transactions&#39;</span>].<span class="ruby-identifier">get</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_savepoints-3F'>
                <a name='method-i-supports_savepoints-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_savepoints?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL supports savepoints</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_savepoints-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_savepoints-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 491</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_savepoints?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_transaction_isolation_levels-3F'>
                <a name='method-i-supports_transaction_isolation_levels-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_transaction_isolation_levels?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL supports transaction isolation levels</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_transaction_isolation_levels-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_transaction_isolation_levels-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 496</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_transaction_isolation_levels?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_transactional_ddl-3F'>
                <a name='method-i-supports_transactional_ddl-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_transactional_ddl?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>PostgreSQL supports transaction DDL statements.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_transactional_ddl-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_transactional_ddl-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 501</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_transactional_ddl?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-tables'>
                <a name='method-i-tables'></a>
                <div class='synopsis'>
                  <span class='name'>tables</span>
                  <span class='arguments'>(opts=OPTS, &block)</span>
                </div>
                <div class='description'>
                  
                  <p>Array of symbols specifying table names in the current database. The
                  dataset used is yielded to the block if one is provided, otherwise, an
                  array of symbols of table names is returned.</p>
                  
                  <p>Options:</p>
                  <dl class="rdoc-list note-list"><dt>:qualify 
                  <dd>
                  <p>Return the tables as Sequel::SQL::QualifiedIdentifier instances, using the
                  schema the table is located in as the qualifier.</p>
                  </dd><dt>:schema 
                  <dd>
                  <p>The schema to search</p>
                  </dd><dt>:server 
                  <dd>
                  <p>The server to use</p>
                  </dd></dl>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-tables-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-tables-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 514</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">tables</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, &amp;<span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-identifier">pg_class_relname</span>(<span class="ruby-string">&#39;r&#39;</span>, <span class="ruby-identifier">opts</span>, &amp;<span class="ruby-identifier">block</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-type_supported-3F'>
                <a name='method-i-type_supported-3F'></a>
                <div class='synopsis'>
                  <span class='name'>type_supported?</span>
                  <span class='arguments'>(type)</span>
                </div>
                <div class='description'>
                  
                  <p>Check whether the given type name string/symbol (e.g. :hstore) is supported
                  by the database.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-type_supported-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-type_supported-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 520</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">type_supported?</span>(<span class="ruby-identifier">type</span>)&#x000A;  <span class="ruby-ivar">@supported_types</span> <span class="ruby-operator">||=</span> {}&#x000A;  <span class="ruby-ivar">@supported_types</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">type</span>){<span class="ruby-ivar">@supported_types</span>[<span class="ruby-identifier">type</span>] = (<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_type</span>).<span class="ruby-identifier">filter</span>(<span class="ruby-value">:typtype=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;b&#39;</span>, <span class="ruby-value">:typname=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-views'>
                <a name='method-i-views'></a>
                <div class='synopsis'>
                  <span class='name'>views</span>
                  <span class='arguments'>(opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Array of symbols specifying view names in the current database.</p>
                  
                  <p>Options:</p>
                  <dl class="rdoc-list note-list"><dt>:qualify 
                  <dd>
                  <p>Return the views as Sequel::SQL::QualifiedIdentifier instances, using the
                  schema the view is located in as the qualifier.</p>
                  </dd><dt>:schema 
                  <dd>
                  <p>The schema to search</p>
                  </dd><dt>:server 
                  <dd>
                  <p>The server to use</p>
                  </dd></dl>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-views-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-views-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 532</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">views</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">pg_class_relname</span>(<span class="ruby-string">&#39;v&#39;</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
