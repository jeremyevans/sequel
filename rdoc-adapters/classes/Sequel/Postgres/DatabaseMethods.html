<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Sequel::Postgres::DatabaseMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Sequel::Postgres::DatabaseMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../files/lib/sequel/adapters/shared/postgres_rb.html">lib/sequel/adapters/shared/postgres.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-add_conversion_proc">add_conversion_proc</a></li>
<li><a href="#method-i-add_named_conversion_proc">add_named_conversion_proc</a></li>
<li><a href="#method-i-check_constraints">check_constraints</a></li>
<li><a href="#method-i-commit_prepared_transaction">commit_prepared_transaction</a></li>
<li><a href="#attribute-i-conversion_procs">conversion_procs</a></li>
<li><a href="#method-i-convert_serial_to_identity">convert_serial_to_identity</a></li>
<li><a href="#method-i-create_function">create_function</a></li>
<li><a href="#method-i-create_language">create_language</a></li>
<li><a href="#method-i-create_schema">create_schema</a></li>
<li><a href="#method-i-create_trigger">create_trigger</a></li>
<li><a href="#method-i-database_type">database_type</a></li>
<li><a href="#method-i-do">do</a></li>
<li><a href="#method-i-drop_function">drop_function</a></li>
<li><a href="#method-i-drop_language">drop_language</a></li>
<li><a href="#method-i-drop_schema">drop_schema</a></li>
<li><a href="#method-i-drop_trigger">drop_trigger</a></li>
<li><a href="#method-i-foreign_key_list">foreign_key_list</a></li>
<li><a href="#method-i-freeze">freeze</a></li>
<li><a href="#method-i-indexes">indexes</a></li>
<li><a href="#method-i-locks">locks</a></li>
<li><a href="#method-i-notify">notify</a></li>
<li><a href="#method-i-primary_key">primary_key</a></li>
<li><a href="#method-i-primary_key_sequence">primary_key_sequence</a></li>
<li><a href="#method-i-refresh_view">refresh_view</a></li>
<li><a href="#method-i-reset_primary_key_sequence">reset_primary_key_sequence</a></li>
<li><a href="#method-i-rollback_prepared_transaction">rollback_prepared_transaction</a></li>
<li><a href="#method-i-serial_primary_key_options">serial_primary_key_options</a></li>
<li><a href="#method-i-server_version">server_version</a></li>
<li><a href="#method-i-supports_create_table_if_not_exists-3F">supports_create_table_if_not_exists?</a></li>
<li><a href="#method-i-supports_deferrable_constraints-3F">supports_deferrable_constraints?</a></li>
<li><a href="#method-i-supports_deferrable_foreign_key_constraints-3F">supports_deferrable_foreign_key_constraints?</a></li>
<li><a href="#method-i-supports_drop_table_if_exists-3F">supports_drop_table_if_exists?</a></li>
<li><a href="#method-i-supports_partial_indexes-3F">supports_partial_indexes?</a></li>
<li><a href="#method-i-supports_prepared_transactions-3F">supports_prepared_transactions?</a></li>
<li><a href="#method-i-supports_savepoints-3F">supports_savepoints?</a></li>
<li><a href="#method-i-supports_transaction_isolation_levels-3F">supports_transaction_isolation_levels?</a></li>
<li><a href="#method-i-supports_transactional_ddl-3F">supports_transactional_ddl?</a></li>
<li><a href="#method-i-supports_trigger_conditions-3F">supports_trigger_conditions?</a></li>
<li><a href="#method-i-tables">tables</a></li>
<li><a href="#method-i-type_supported-3F">type_supported?</a></li>
<li><a href="#method-i-values">values</a></li>
<li><a href="#method-i-views">views</a></li>
</ol>
</div>
<div id='context'>
<div id='includes'>
<h2>Included modules</h2>
<ol>
<li><a href="../UnmodifiedIdentifiers/DatabaseMethods.html">UnmodifiedIdentifiers::DatabaseMethods</a></li>
</ol>
</div>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>DATABASE_ERROR_REGEXPS</td>
<td>=</td>
<td class='context-item-value'>[
# Add this check first, since otherwise it's possible for users to control
# which exception class is generated.
[/invalid input syntax/, DatabaseError],
[/duplicate key value violates unique constraint/, UniqueConstraintViolation],
[/violates foreign key constraint/, ForeignKeyConstraintViolation],
[/violates check constraint/, CheckConstraintViolation],
[/violates not-null constraint/, NotNullConstraintViolation],
[/conflicting key value violates exclusion constraint/, ExclusionConstraintViolation],
[/could not serialize access/, SerializationFailure],
[/could not obtain lock on row in relation/, DatabaseLockTimeout],
].freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>FOREIGN_KEY_LIST_ON_DELETE_MAP</td>
<td>=</td>
<td class='context-item-value'>{'a'=>:no_action, 'r'=>:restrict, 'c'=>:cascade, 'n'=>:set_null, 'd'=>:set_default}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>ON_COMMIT</td>
<td>=</td>
<td class='context-item-value'>{:drop => 'DROP', :delete_rows => 'DELETE ROWS', :preserve_rows => 'PRESERVE ROWS'}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>PREPARED_ARG_PLACEHOLDER</td>
<td>=</td>
<td class='context-item-value'>LiteralString.new('$').freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>SELECT_CUSTOM_SEQUENCE_SQL</td>
<td>=</td>
<td class='context-item-value'>(<<-end_sql
SELECT name.nspname AS "schema",
CASE
WHEN split_part(def.adsrc, '''', 2) ~ '.' THEN
substr(split_part(def.adsrc, '''', 2),
strpos(split_part(def.adsrc, '''', 2), '.')+1)
ELSE split_part(def.adsrc, '''', 2)
END AS "sequence"
FROM pg_class t
JOIN pg_namespace  name ON (t.relnamespace = name.oid)
JOIN pg_attribute  attr ON (t.oid = attrelid)
JOIN pg_attrdef    def  ON (adrelid = attrelid AND adnum = attnum)
JOIN pg_constraint cons ON (conrelid = adrelid AND adnum = conkey[1])
WHERE cons.contype = 'p'
AND def.adsrc ~* 'nextval'
end_sql
).strip.gsub(/\s+/, ' ').freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'>
<p><a href="../SQL.html">SQL</a> fragment for custom sequences (ones not
created by serial primary key), Returning the schema and literal form of
the sequence name, by parsing the column defaults table.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>SELECT_PK_SQL</td>
<td>=</td>
<td class='context-item-value'>(<<-end_sql
SELECT pg_attribute.attname AS pk
FROM pg_class, pg_attribute, pg_index, pg_namespace
WHERE pg_class.oid = pg_attribute.attrelid
AND pg_class.relnamespace  = pg_namespace.oid
AND pg_class.oid = pg_index.indrelid
AND pg_index.indkey[0] = pg_attribute.attnum
AND pg_index.indisprimary = 't'
end_sql
).strip.gsub(/\s+/, ' ').freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'>
<p><a href="../SQL.html">SQL</a> fragment for determining primary key column
for the given table.  Only returns the first primary key if the table has a
composite primary key.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>SELECT_SERIAL_SEQUENCE_SQL</td>
<td>=</td>
<td class='context-item-value'>(<<-end_sql
SELECT  name.nspname AS "schema", seq.relname AS "sequence"
FROM pg_class seq, pg_attribute attr, pg_depend dep,
pg_namespace name, pg_constraint cons, pg_class t
WHERE seq.oid = dep.objid
AND seq.relnamespace  = name.oid
AND seq.relkind = 'S'
AND attr.attrelid = dep.refobjid
AND attr.attnum = dep.refobjsubid
AND attr.attrelid = cons.conrelid
AND attr.attnum = cons.conkey[1]
AND attr.attrelid = t.oid
AND cons.contype = 'p'
end_sql
).strip.gsub(/\s+/, ' ').freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'>
<p><a href="../SQL.html">SQL</a> fragment for getting sequence associated with
table&#39;s primary key, assuming it was a serial primary key column.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>VALID_CLIENT_MIN_MESSAGES</td>
<td>=</td>
<td class='context-item-value'>%w'DEBUG5 DEBUG4 DEBUG3 DEBUG2 DEBUG1 LOG NOTICE WARNING ERROR FATAL PANIC'.freeze.each(&:freeze)</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-conversion_procs'>conversion_procs</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'>
<p>A hash of conversion procs, keyed by type integer (oid) and having callable
values for the conversion proc for that type.</p>
</td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-add_conversion_proc'>
<a name='method-i-add_conversion_proc'></a>
<div class='synopsis'>
<span class='name'>add_conversion_proc</span>
<span class='arguments'>(oid, callable=Proc.new)</span>

</div>
<div class='description'>

<p>Set a conversion proc for the given oid.  The callable can be passed either
as a argument or a block.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-add_conversion_proc-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-add_conversion_proc-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 197</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_conversion_proc</span>(<span class="ruby-identifier">oid</span>, <span class="ruby-identifier">callable</span>=<span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span>)&#x000A;  <span class="ruby-identifier">conversion_procs</span>[<span class="ruby-identifier">oid</span>] = <span class="ruby-identifier">callable</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-add_named_conversion_proc'>
<a name='method-i-add_named_conversion_proc'></a>
<div class='synopsis'>
<span class='name'>add_named_conversion_proc</span>
<span class='arguments'>(name, &block)</span>

</div>
<div class='description'>

<p>Add a conversion proc for a named type, using the given block. This should
be used for types without fixed OIDs, which includes all types that are not
included in a default PostgreSQL installation.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-add_named_conversion_proc-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-add_named_conversion_proc-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 204</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_named_conversion_proc</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">oid</span> = <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_type</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:typtype</span><span class="ruby-operator">=&gt;</span>[<span class="ruby-string">&#39;b&#39;</span>, <span class="ruby-string">&#39;e&#39;</span>], <span class="ruby-value">:typname</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">get</span>(<span class="ruby-value">:oid</span>)&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;No matching type in pg_type for #{name.inspect}&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">add_conversion_proc</span>(<span class="ruby-identifier">oid</span>, <span class="ruby-identifier">block</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-check_constraints'>
<a name='method-i-check_constraints'></a>
<div class='synopsis'>
<span class='name'>check_constraints</span>
<span class='arguments'>(table)</span>

</div>
<div class='description'>

<p>A hash of metadata for CHECK constraints on the table. Keys are CHECK
constraint name symbols.  Values are hashes with the following keys:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:definition </td><td>
<p>An <a href="../SQL.html">SQL</a> fragment for the definition of the
constraint</p>
</td></tr><tr><td class='label'>:columns </td><td>
<p>An array of column symbols for the columns referenced in the constraint</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-check_constraints-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-check_constraints-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 219</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">check_constraints</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>&#x000A;&#x000A;  <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">from</span>{<span class="ruby-identifier">pg_constraint</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:co</span>)}.&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_attribute</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:att</span>), <span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:conrelid</span>, <span class="ruby-value">:attnum</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:co</span>][<span class="ruby-value">:conkey</span>])).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:conrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>), <span class="ruby-value">:contype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;c&#39;</span>).&#x000A;    <span class="ruby-identifier">select</span>{[<span class="ruby-identifier">co</span>[<span class="ruby-value">:conname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:constraint</span>), <span class="ruby-identifier">att</span>[<span class="ruby-value">:attname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:column</span>), <span class="ruby-identifier">pg_get_constraintdef</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:oid</span>]).<span class="ruby-identifier">as</span>(<span class="ruby-value">:definition</span>)]}&#x000A;&#x000A;  <span class="ruby-identifier">hash</span> = {}&#x000A;  <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">constraint</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:constraint</span>])&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">constraint</span>]&#x000A;      <span class="ruby-identifier">entry</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">constraint</span>] = {<span class="ruby-value">:definition</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">row</span>[<span class="ruby-value">:definition</span>], <span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])]}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  &#x000A;  <span class="ruby-identifier">hash</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-commit_prepared_transaction'>
<a name='method-i-commit_prepared_transaction'></a>
<div class='synopsis'>
<span class='name'>commit_prepared_transaction</span>
<span class='arguments'>(transaction_id, opts=OPTS)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-commit_prepared_transaction-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-commit_prepared_transaction-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 211</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">commit_prepared_transaction</span>(<span class="ruby-identifier">transaction_id</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">run</span>(<span class="ruby-node">&quot;COMMIT PREPARED #{literal(transaction_id)}&quot;</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-convert_serial_to_identity'>
<a name='method-i-convert_serial_to_identity'></a>
<div class='synopsis'>
<span class='name'>convert_serial_to_identity</span>
<span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Convert the first primary key column in the <code>table</code> from being a
serial column to being an identity column. If the column is already an
identity column, assume it was already converted and make no changes.</p>

<p>Only supported on PostgreSQL 10.2+, since on those versions <a
href="../../Sequel.html">Sequel</a> will use identity columns instead of
serial columns for auto incrementing primary keys. Only supported when
running as a superuser, since regular users cannot modify system tables,
and there is no way to keep an existing sequence when changing an existing
column to be an identity column.</p>

<p>This method can raise an exception in at least the following cases where it
may otherwise succeed (there may be additional cases not listed here):</p>
<ul><li>
<p>The serial column was added after table creation using PostgreSQL &lt;7.3</p>
</li><li>
<p>A regular index also exists on the column (such an index can probably be
dropped as the primary key index should suffice)</p>
</li></ul>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:column </td><td>
<p>Specify the column to convert instead of using the first primary key column</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>Run the <a href="../SQL.html">SQL</a> on the given server</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-convert_serial_to_identity-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-convert_serial_to_identity-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 259</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">convert_serial_to_identity</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;convert_serial_to_identity is only supported on PostgreSQL 10.2+&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">100002</span>&#x000A;&#x000A;  <span class="ruby-identifier">server</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>]&#x000A;  <span class="ruby-identifier">server_hash</span> = <span class="ruby-identifier">server</span> <span class="ruby-operator">?</span> {<span class="ruby-value">:server</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">server</span>} <span class="ruby-operator">:</span> {}&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">dataset</span>&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">server</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server</span>&#x000A;&#x000A;  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;convert_serial_to_identity requires superuser permissions&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">get</span>{<span class="ruby-identifier">current_setting</span>(<span class="ruby-string">&#39;is_superuser&#39;</span>)} <span class="ruby-operator">==</span> <span class="ruby-string">&#39;on&#39;</span>&#x000A;&#x000A;  <span class="ruby-identifier">table_oid</span> = <span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-identifier">im</span> = <span class="ruby-identifier">input_identifier_meth</span>&#x000A;  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">column</span> = <span class="ruby-identifier">im</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:column</span>] <span class="ruby-operator">||</span> ((<span class="ruby-identifier">sch</span> = <span class="ruby-identifier">schema</span>(<span class="ruby-identifier">table</span>).<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">col</span>, <span class="ruby-identifier">sch</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sch</span>[<span class="ruby-value">:primary_key</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sch</span>[<span class="ruby-value">:auto_increment</span>]}) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sch</span>[<span class="ruby-value">0</span>]))&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;could not determine column to convert from serial to identity automatically&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">column_num</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_attribute</span>).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table_oid</span>, <span class="ruby-value">:attname</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">column</span>).&#x000A;    <span class="ruby-identifier">get</span>(<span class="ruby-value">:attnum</span>)&#x000A;&#x000A;  <span class="ruby-identifier">pg_class</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">cast</span>(<span class="ruby-string">&#39;pg_class&#39;</span>, <span class="ruby-value">:regclass</span>)&#x000A;  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_depend</span>).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:refclassid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">pg_class</span>, <span class="ruby-value">:refobjid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table_oid</span>, <span class="ruby-value">:refobjsubid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">column_num</span>, <span class="ruby-value">:classid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">pg_class</span>, <span class="ruby-value">:objsubid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">0</span>, <span class="ruby-value">:deptype</span><span class="ruby-operator">=&gt;</span><span class="ruby-node">%w&#39;a i&#39;</span>).&#x000A;    <span class="ruby-identifier">select_map</span>([<span class="ruby-value">:objid</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>({<span class="ruby-value">:deptype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;i&#39;</span>}, <span class="ruby-value">:v</span>)])&#x000A;&#x000A;  <span class="ruby-keyword">case</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">length</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-value">0</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;unable to find related sequence when converting serial to identity&quot;</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-value">1</span>&#x000A;    <span class="ruby-identifier">seq_oid</span>, <span class="ruby-identifier">already_identity</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">first</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;more than one linked sequence found when converting serial to identity&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">already_identity</span>&#x000A;&#x000A;  <span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">server_hash</span>) <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-identifier">run</span>(<span class="ruby-node">&quot;ALTER TABLE #{quote_schema_table(table)} ALTER COLUMN #{quote_identifier(column)} DROP DEFAULT&quot;</span>, <span class="ruby-identifier">server_hash</span>)&#x000A;&#x000A;    <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_depend</span>).&#x000A;      <span class="ruby-identifier">where</span>(<span class="ruby-value">:classid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">pg_class</span>, <span class="ruby-value">:objid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">seq_oid</span>, <span class="ruby-value">:objsubid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">0</span>, <span class="ruby-value">:deptype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;a&#39;</span>).&#x000A;      <span class="ruby-identifier">update</span>(<span class="ruby-value">:deptype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;i&#39;</span>)&#x000A;&#x000A;    <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_attribute</span>).&#x000A;      <span class="ruby-identifier">where</span>(<span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table_oid</span>, <span class="ruby-value">:attname</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">column</span>).&#x000A;      <span class="ruby-identifier">update</span>(<span class="ruby-value">:attidentity</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;d&#39;</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">remove_cached_schema</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-keyword">nil</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_function'>
<a name='method-i-create_function'></a>
<div class='synopsis'>
<span class='name'>create_function</span>
<span class='arguments'>(name, definition, opts=OPTS)</span>

</div>
<div class='description'>

<p>Creates the function in the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>name of the function to create</p>
</td></tr><tr><td class='label'>definition </td><td>
<p>string definition of the function, or object file for a dynamically loaded
C function.</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:args </td><td>
<p>function arguments, can be either a symbol or string specifying a type or
an array of 1-3 elements:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>1 </td><td>
<p>argument data type</p>
</td></tr><tr><td class='label'>2 </td><td>
<p>argument name</p>
</td></tr><tr><td class='label'>3 </td><td>
<p>argument mode (e.g. in, out, inout)</p>
</td></tr></tbody></table>
</td></tr><tr><td class='label'>:behavior </td><td>
<p>Should be IMMUTABLE, STABLE, or VOLATILE.  PostgreSQL assumes VOLATILE by
default.</p>
</td></tr><tr><td class='label'>:cost </td><td>
<p>The estimated cost of the function, used by the query planner.</p>
</td></tr><tr><td class='label'>:language </td><td>
<p>The language the function uses.  <a href="../SQL.html">SQL</a> is the
default.</p>
</td></tr><tr><td class='label'>:link_symbol </td><td>
<p>For a dynamically loaded see function, the function&#39;s link symbol if
different from the definition argument.</p>
</td></tr><tr><td class='label'>:returns </td><td>
<p>The data type returned by the function.  If you are using OUT or INOUT
argument modes, this is ignored. Otherwise, if this is not specified, void
is used by default to specify the function is not supposed to return a
value.</p>
</td></tr><tr><td class='label'>:rows </td><td>
<p>The estimated number of rows the function will return.  Only use if the
function returns SETOF something.</p>
</td></tr><tr><td class='label'>:security_definer </td><td>
<p>Makes the privileges of the function the same as the privileges of the user
who defined the function instead of the privileges of the user who runs the
function.  There are security implications when doing this, see the
PostgreSQL documentation.</p>
</td></tr><tr><td class='label'>:set </td><td>
<p>Configuration variables to set while the function is being run, can be a
hash or an array of two pairs.  search_path is often used here if
:security_definer is used.</p>
</td></tr><tr><td class='label'>:strict </td><td>
<p>Makes the function return NULL when any argument is NULL.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_function-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_function-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 331</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_function</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">definition</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_function_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">definition</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_language'>
<a name='method-i-create_language'></a>
<div class='synopsis'>
<span class='name'>create_language</span>
<span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Create the procedural language in the database. Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>Name of the procedural language (e.g. plpgsql)</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:handler </td><td>
<p>The name of a previously registered function used as a call handler for
this language.</p>
</td></tr><tr><td class='label'>:replace </td><td>
<p>Replace the installed language if it already exists (on PostgreSQL 9.0+).</p>
</td></tr><tr><td class='label'>:trusted </td><td>
<p>Marks the language being created as trusted, allowing unprivileged users to
create functions using this language.</p>
</td></tr><tr><td class='label'>:validator </td><td>
<p>The name of previously registered function used as a validator of functions
defined in this language.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_language-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_language-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 342</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_language</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_language_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_schema'>
<a name='method-i-create_schema'></a>
<div class='synopsis'>
<span class='name'>create_schema</span>
<span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Create a schema in the database. Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>Name of the schema (e.g. admin)</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:if_not_exists </td><td>
<p>Don&#39;t raise an error if the schema already exists (PostgreSQL 9.3+)</p>
</td></tr><tr><td class='label'>:owner </td><td>
<p>The owner to set for the schema (defaults to current user if not specified)</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_schema-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_schema-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 351</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_schema</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_schema_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_trigger'>
<a name='method-i-create_trigger'></a>
<div class='synopsis'>
<span class='name'>create_trigger</span>
<span class='arguments'>(table, name, function, opts=OPTS)</span>

</div>
<div class='description'>

<p>Create a trigger in the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>table </td><td>
<p>the table on which this trigger operates</p>
</td></tr><tr><td class='label'>name </td><td>
<p>the name of this trigger</p>
</td></tr><tr><td class='label'>function </td><td>
<p>the function to call for this trigger, which should return type trigger.</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:after </td><td>
<p>Calls the trigger after execution instead of before.</p>
</td></tr><tr><td class='label'>:args </td><td>
<p>An argument or array of arguments to pass to the function.</p>
</td></tr><tr><td class='label'>:each_row </td><td>
<p>Calls the trigger for each row instead of for each statement.</p>
</td></tr><tr><td class='label'>:events </td><td>
<p>Can be :insert, :update, :delete, or an array of any of those. Calls the
trigger whenever that type of statement is used.  By default, the trigger
is called for insert, update, or delete.</p>
</td></tr><tr><td class='label'>:when </td><td>
<p>A filter to use for the trigger</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_trigger-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_trigger-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 366</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_trigger</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">function</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_trigger_sql</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">function</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-database_type'>
<a name='method-i-database_type'></a>
<div class='synopsis'>
<span class='name'>database_type</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-database_type-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-database_type-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 370</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">database_type</span>&#x000A;  <span class="ruby-value">:postgres</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-do'>
<a name='method-i-do'></a>
<div class='synopsis'>
<span class='name'>do</span>
<span class='arguments'>(code, opts=OPTS)</span>

</div>
<div class='description'>

<p>Use PostgreSQL&#39;s DO syntax to execute an anonymous code block.  The
code should be the literal code string to use in the underlying procedural
language.  Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:language </td><td>
<p>The procedural language the code is written in.  The PostgreSQL default is
plpgsql.  Can be specified as a string or a symbol.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-do-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-do-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 379</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">do</span>(<span class="ruby-identifier ruby-title">code</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">language</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:language</span>]&#x000A;  <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;DO #{&quot;LANGUAGE #{literal(language.to_s)} &quot; if language}#{literal(code)}&quot;</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-drop_function'>
<a name='method-i-drop_function'></a>
<div class='synopsis'>
<span class='name'>drop_function</span>
<span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Drops the function from the database. Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>name of the function to drop</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:args </td><td>
<p>The arguments for the function.  See create_function_sql.</p>
</td></tr><tr><td class='label'>:cascade </td><td>
<p>Drop other objects depending on this function.</p>
</td></tr><tr><td class='label'>:if_exists </td><td>
<p>Don&#39;t raise an error if the function doesn&#39;t exist.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-drop_function-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-drop_function-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 390</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">drop_function</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_function_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-drop_language'>
<a name='method-i-drop_language'></a>
<div class='synopsis'>
<span class='name'>drop_language</span>
<span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Drops a procedural language from the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>name of the procedural language to drop</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:cascade </td><td>
<p>Drop other objects depending on this function.</p>
</td></tr><tr><td class='label'>:if_exists </td><td>
<p>Don&#39;t raise an error if the function doesn&#39;t exist.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-drop_language-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-drop_language-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 399</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">drop_language</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_language_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-drop_schema'>
<a name='method-i-drop_schema'></a>
<div class='synopsis'>
<span class='name'>drop_schema</span>
<span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Drops a schema from the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>name of the schema to drop</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:cascade </td><td>
<p>Drop all objects in this schema.</p>
</td></tr><tr><td class='label'>:if_exists </td><td>
<p>Don&#39;t raise an error if the schema doesn&#39;t exist.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-drop_schema-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-drop_schema-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 408</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">drop_schema</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_schema_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-drop_trigger'>
<a name='method-i-drop_trigger'></a>
<div class='synopsis'>
<span class='name'>drop_trigger</span>
<span class='arguments'>(table, name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Drops a trigger from the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>table </td><td>
<p>table from which to drop the trigger</p>
</td></tr><tr><td class='label'>name </td><td>
<p>name of the trigger to drop</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:cascade </td><td>
<p>Drop other objects depending on this function.</p>
</td></tr><tr><td class='label'>:if_exists </td><td>
<p>Don&#39;t raise an error if the function doesn&#39;t exist.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-drop_trigger-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-drop_trigger-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 418</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">drop_trigger</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_trigger_sql</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-foreign_key_list'>
<a name='method-i-foreign_key_list'></a>
<div class='synopsis'>
<span class='name'>foreign_key_list</span>
<span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return full foreign key information using the pg system tables, including
:name, :on_delete, :on_update, and :deferrable entries in the hashes.</p>

<p>Supports additional options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:reverse </td><td>
<p>Instead of returning foreign keys in the current table, return foreign keys
in other tables that reference the current table.</p>
</td></tr><tr><td class='label'>:schema </td><td>
<p>Set to true to have the :table value in the hashes be a qualified
identifier.  Set to false to use a separate :schema value with the related
schema.  Defaults to whether the given table argument is a qualified
identifier.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-foreign_key_list-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-foreign_key_list-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 432</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">foreign_key_list</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>&#x000A;  <span class="ruby-identifier">schema</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:schema</span>, <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table</span>))&#x000A;  <span class="ruby-identifier">oid</span> = <span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-identifier">reverse</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:reverse</span>]&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">reverse</span>&#x000A;    <span class="ruby-identifier">ctable</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att2</span>]&#x000A;    <span class="ruby-identifier">cclass</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl2</span>]&#x000A;    <span class="ruby-identifier">rtable</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att</span>]&#x000A;    <span class="ruby-identifier">rclass</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl</span>]&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">ctable</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att</span>]&#x000A;    <span class="ruby-identifier">cclass</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl</span>]&#x000A;    <span class="ruby-identifier">rtable</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att2</span>]&#x000A;    <span class="ruby-identifier">rclass</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl2</span>]&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90500</span>&#x000A;    <span class="ruby-identifier">cpos</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">expr</span>{<span class="ruby-identifier">array_position</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:conkey</span>], <span class="ruby-identifier">ctable</span>[<span class="ruby-value">:attnum</span>])}&#x000A;    <span class="ruby-identifier">rpos</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">expr</span>{<span class="ruby-identifier">array_position</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:confkey</span>], <span class="ruby-identifier">rtable</span>[<span class="ruby-value">:attnum</span>])}&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">range</span> = <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">32</span>&#x000A;    <span class="ruby-identifier">cpos</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">expr</span>{<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:conkey</span>], [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-identifier">ctable</span>[<span class="ruby-value">:attnum</span>])}&#x000A;    <span class="ruby-identifier">rpos</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">expr</span>{<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:confkey</span>], [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-identifier">rtable</span>[<span class="ruby-value">:attnum</span>])}&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">from</span>{<span class="ruby-identifier">pg_constraint</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:co</span>)}.&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_class</span>].<span class="ruby-identifier">as</span>(<span class="ruby-identifier">cclass</span>), <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:conrelid</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_attribute</span>].<span class="ruby-identifier">as</span>(<span class="ruby-identifier">ctable</span>), <span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:oid</span>, <span class="ruby-value">:attnum</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:co</span>][<span class="ruby-value">:conkey</span>])).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_class</span>].<span class="ruby-identifier">as</span>(<span class="ruby-identifier">rclass</span>), <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:co</span>][<span class="ruby-value">:confrelid</span>]).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_attribute</span>].<span class="ruby-identifier">as</span>(<span class="ruby-identifier">rtable</span>), <span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:oid</span>, <span class="ruby-value">:attnum</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:co</span>][<span class="ruby-value">:confkey</span>])).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_namespace</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:nsp</span>), <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl2</span>][<span class="ruby-value">:relnamespace</span>]).&#x000A;    <span class="ruby-identifier">order</span>{[<span class="ruby-identifier">co</span>[<span class="ruby-value">:conname</span>], <span class="ruby-identifier">cpos</span>]}.&#x000A;    <span class="ruby-identifier">where</span>{{&#x000A;      <span class="ruby-identifier">cl</span>[<span class="ruby-value">:relkind</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;r&#39;</span>,&#x000A;      <span class="ruby-identifier">co</span>[<span class="ruby-value">:contype</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;f&#39;</span>,&#x000A;      <span class="ruby-identifier">cl</span>[<span class="ruby-value">:oid</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-identifier">oid</span>,&#x000A;      <span class="ruby-identifier">cpos</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">rpos</span>&#x000A;    }}.&#x000A;    <span class="ruby-identifier">select</span>{[&#x000A;      <span class="ruby-identifier">co</span>[<span class="ruby-value">:conname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:name</span>),&#x000A;      <span class="ruby-identifier">ctable</span>[<span class="ruby-value">:attname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:column</span>),&#x000A;      <span class="ruby-identifier">co</span>[<span class="ruby-value">:confupdtype</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:on_update</span>),&#x000A;      <span class="ruby-identifier">co</span>[<span class="ruby-value">:confdeltype</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:on_delete</span>),&#x000A;      <span class="ruby-identifier">cl2</span>[<span class="ruby-value">:relname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:table</span>),&#x000A;      <span class="ruby-identifier">rtable</span>[<span class="ruby-value">:attname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:refcolumn</span>),&#x000A;      <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:AND</span>, <span class="ruby-identifier">co</span>[<span class="ruby-value">:condeferrable</span>], <span class="ruby-identifier">co</span>[<span class="ruby-value">:condeferred</span>]).<span class="ruby-identifier">as</span>(<span class="ruby-value">:deferrable</span>),&#x000A;      <span class="ruby-identifier">nsp</span>[<span class="ruby-value">:nspname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:schema</span>)&#x000A;    ]}&#x000A;&#x000A;  <span class="ruby-identifier">h</span> = {}&#x000A;  <span class="ruby-identifier">fklod_map</span> = <span class="ruby-constant">FOREIGN_KEY_LIST_ON_DELETE_MAP</span> &#x000A;&#x000A;  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">reverse</span>&#x000A;      <span class="ruby-identifier">key</span> = [<span class="ruby-identifier">row</span>[<span class="ruby-value">:schema</span>], <span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>], <span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]]&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">key</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]&#x000A;    <span class="ruby-keyword">end</span>&#x000A;&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span> = <span class="ruby-identifier">h</span>[<span class="ruby-identifier">key</span>]&#x000A;      <span class="ruby-identifier">r</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])&#x000A;      <span class="ruby-identifier">r</span>[<span class="ruby-value">:key</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:refcolumn</span>])&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">h</span>[<span class="ruby-identifier">key</span>] = {&#x000A;        <span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]),&#x000A;        <span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])],&#x000A;        <span class="ruby-value">:key</span><span class="ruby-operator">=&gt;</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:refcolumn</span>])],&#x000A;        <span class="ruby-value">:on_update</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">fklod_map</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:on_update</span>]],&#x000A;        <span class="ruby-value">:on_delete</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">fklod_map</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:on_delete</span>]],&#x000A;        <span class="ruby-value">:deferrable</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">row</span>[<span class="ruby-value">:deferrable</span>],&#x000A;        <span class="ruby-value">:table</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">schema</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:schema</span>]), <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>])) <span class="ruby-operator">:</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>]),&#x000A;      }&#x000A;&#x000A;      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">schema</span>&#x000A;        <span class="ruby-comment"># If not combining schema information into the :table entry</span>&#x000A;        <span class="ruby-comment"># include it as a separate entry.</span>&#x000A;        <span class="ruby-identifier">entry</span>[<span class="ruby-value">:schema</span>] = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:schema</span>])&#x000A;      <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">h</span>.<span class="ruby-identifier">values</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-freeze'>
<a name='method-i-freeze'></a>
<div class='synopsis'>
<span class='name'>freeze</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-freeze-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-freeze-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 519</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>&#x000A;  <span class="ruby-identifier">server_version</span>&#x000A;  <span class="ruby-identifier">supports_prepared_transactions?</span>&#x000A;  <span class="ruby-ivar">@conversion_procs</span>.<span class="ruby-identifier">freeze</span>&#x000A;  <span class="ruby-keyword">super</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-indexes'>
<a name='method-i-indexes'></a>
<div class='synopsis'>
<span class='name'>indexes</span>
<span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Use the pg_* system tables to determine indexes on a table</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-indexes-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-indexes-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 527</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">indexes</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>&#x000A;  <span class="ruby-identifier">oid</span> = <span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>)&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90500</span>&#x000A;    <span class="ruby-identifier">order</span> = [<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:indc</span>][<span class="ruby-value">:relname</span>], <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-value">:array_position</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:ind</span>][<span class="ruby-value">:indkey</span>], <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att</span>][<span class="ruby-value">:attnum</span>])]&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">range</span> = <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">32</span>&#x000A;    <span class="ruby-identifier">order</span> = [<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:indc</span>][<span class="ruby-value">:relname</span>], <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:ind</span>][<span class="ruby-value">:indkey</span>], [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att</span>][<span class="ruby-value">:attnum</span>])]&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">attnums</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:ind</span>][<span class="ruby-value">:indkey</span>])&#x000A;&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">from</span>{<span class="ruby-identifier">pg_class</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:tab</span>)}.&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_index</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:ind</span>), <span class="ruby-value">:indrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:oid</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_class</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:indc</span>), <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:indexrelid</span>).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_attribute</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:att</span>), <span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:tab</span>][<span class="ruby-value">:oid</span>], <span class="ruby-value">:attnum</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">attnums</span>).&#x000A;    <span class="ruby-identifier">left_join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_constraint</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:con</span>), <span class="ruby-value">:conname</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:indc</span>][<span class="ruby-value">:relname</span>]).&#x000A;    <span class="ruby-identifier">where</span>{{&#x000A;      <span class="ruby-identifier">indc</span>[<span class="ruby-value">:relkind</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;i&#39;</span>,&#x000A;      <span class="ruby-identifier">ind</span>[<span class="ruby-value">:indisprimary</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-keyword">false</span>,&#x000A;      <span class="ruby-value">:indexprs</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>,&#x000A;      <span class="ruby-value">:indisvalid</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>,&#x000A;      <span class="ruby-identifier">tab</span>[<span class="ruby-value">:oid</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-identifier">oid</span>}}.&#x000A;    <span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">order</span>).&#x000A;    <span class="ruby-identifier">select</span>{[<span class="ruby-identifier">indc</span>[<span class="ruby-value">:relname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:name</span>), <span class="ruby-identifier">ind</span>[<span class="ruby-value">:indisunique</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:unique</span>), <span class="ruby-identifier">att</span>[<span class="ruby-value">:attname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:column</span>), <span class="ruby-identifier">con</span>[<span class="ruby-value">:condeferrable</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:deferrable</span>)]}&#x000A;&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:indpred</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:include_partial</span>]&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:indisready</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">80300</span>&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:indislive</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90300</span>&#x000A;&#x000A;  <span class="ruby-identifier">indexes</span> = {}&#x000A;  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">i</span> = <span class="ruby-identifier">indexes</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:name</span>])] <span class="ruby-operator">||=</span> {<span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span>[], <span class="ruby-value">:unique</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">r</span>[<span class="ruby-value">:unique</span>], <span class="ruby-value">:deferrable</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">r</span>[<span class="ruby-value">:deferrable</span>]}&#x000A;    <span class="ruby-identifier">i</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:column</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">indexes</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-locks'>
<a name='method-i-locks'></a>
<div class='synopsis'>
<span class='name'>locks</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p><a href="Dataset.html">Dataset</a> containing all current database locks</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-locks-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-locks-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 568</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">locks</span>&#x000A;  <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_class</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_locks</span>, <span class="ruby-value">:relation</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:relfilenode</span>).<span class="ruby-identifier">select</span>{[<span class="ruby-identifier">pg_class</span>[<span class="ruby-value">:relname</span>], <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">ColumnAll</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:pg_locks</span>)]}&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-notify'>
<a name='method-i-notify'></a>
<div class='synopsis'>
<span class='name'>notify</span>
<span class='arguments'>(channel, opts=OPTS)</span>

</div>
<div class='description'>

<p>Notifies the given channel.  See the PostgreSQL NOTIFY documentation.
Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:payload </td><td>
<p>The payload string to use for the NOTIFY statement.  Only supported in
PostgreSQL 9.0+.</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>The server to which to send the NOTIFY statement, if the sharding support
is being used.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-notify-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-notify-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 578</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">notify</span>(<span class="ruby-identifier">channel</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">sql</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>&#x000A;  <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;NOTIFY &quot;</span>&#x000A;  <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:identifier_append</span>, <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">channel</span>)&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">payload</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:payload</span>]&#x000A;    <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;, &quot;</span>&#x000A;    <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">to_s</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">execute_ddl</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-primary_key'>
<a name='method-i-primary_key'></a>
<div class='synopsis'>
<span class='name'>primary_key</span>
<span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return primary key for the given table.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-primary_key-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-primary_key-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 590</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_key</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">quoted_table</span> = <span class="ruby-identifier">quote_schema_table</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@primary_keys</span>[<span class="ruby-identifier">quoted_table</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@primary_keys</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">quoted_table</span>)}&#x000A;  <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_PK_SQL} AND pg_class.oid = #{literal(regclass_oid(table, opts))}&quot;</span>&#x000A;  <span class="ruby-identifier">value</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_value</span>&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_keys</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-primary_key_sequence'>
<a name='method-i-primary_key_sequence'></a>
<div class='synopsis'>
<span class='name'>primary_key_sequence</span>
<span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return the sequence providing the default for the primary key for the given
table.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-primary_key_sequence-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-primary_key_sequence-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 599</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_key_sequence</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">quoted_table</span> = <span class="ruby-identifier">quote_schema_table</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@primary_key_sequences</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">quoted_table</span>)}&#x000A;  <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_SERIAL_SEQUENCE_SQL} AND t.oid = #{literal(regclass_oid(table, opts))}&quot;</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pks</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_record</span>&#x000A;    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">literal</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:schema</span>], <span class="ruby-identifier">pks</span>[<span class="ruby-value">:sequence</span>]))&#x000A;    <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_CUSTOM_SEQUENCE_SQL} AND t.oid = #{literal(regclass_oid(table, opts))}&quot;</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">pks</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_record</span>&#x000A;      <span class="ruby-identifier">value</span> = <span class="ruby-identifier">literal</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:schema</span>], <span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:sequence</span>])))&#x000A;      <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-refresh_view'>
<a name='method-i-refresh_view'></a>
<div class='synopsis'>
<span class='name'>refresh_view</span>
<span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Refresh the materialized view with the given name.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">refresh_view</span>(<span class="ruby-value">:items_view</span>)&#x000A;<span class="ruby-comment"># REFRESH MATERIALIZED VIEW items_view</span>&#x000A;<span class="ruby-constant">DB</span>.<span class="ruby-identifier">refresh_view</span>(<span class="ruby-value">:items_view</span>, <span class="ruby-value">:concurrently</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)&#x000A;<span class="ruby-comment"># REFRESH MATERIALIZED VIEW CONCURRENTLY items_view</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-refresh_view-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-refresh_view-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 621</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">refresh_view</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;REFRESH MATERIALIZED VIEW#{&#39; CONCURRENTLY&#39; if opts[:concurrently]} #{quote_schema_table(name)}&quot;</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-reset_primary_key_sequence'>
<a name='method-i-reset_primary_key_sequence'></a>
<div class='synopsis'>
<span class='name'>reset_primary_key_sequence</span>
<span class='arguments'>(table)</span>

</div>
<div class='description'>

<p>Reset the primary key sequence for the given table, basing it on the
maximum current value of the table&#39;s primary key.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-reset_primary_key_sequence-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-reset_primary_key_sequence-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 627</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reset_primary_key_sequence</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">seq</span> = <span class="ruby-identifier">primary_key_sequence</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-identifier">pk</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">primary_key</span>(<span class="ruby-identifier">table</span>))&#x000A;  <span class="ruby-identifier">db</span> = <span class="ruby-keyword">self</span>&#x000A;  <span class="ruby-identifier">s</span>, <span class="ruby-identifier">t</span> = <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-identifier">table</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">t</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">100000</span>&#x000A;    <span class="ruby-identifier">seq_ds</span> = <span class="ruby-identifier">metadata_dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_sequence</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:seqrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">regclass_oid</span>(<span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">seq</span>)))&#x000A;    <span class="ruby-identifier">increment_by</span> = <span class="ruby-value">:seqincrement</span>&#x000A;    <span class="ruby-identifier">min_value</span> = <span class="ruby-value">:seqmin</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">seq_ds</span> = <span class="ruby-identifier">metadata_dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">seq</span>))&#x000A;    <span class="ruby-identifier">increment_by</span> = <span class="ruby-value">:increment_by</span>&#x000A;    <span class="ruby-identifier">min_value</span> = <span class="ruby-value">:min_value</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">get</span>{<span class="ruby-identifier">setval</span>(<span class="ruby-identifier">seq</span>, <span class="ruby-identifier">db</span>[<span class="ruby-identifier">table</span>].<span class="ruby-identifier">select</span>(<span class="ruby-identifier">coalesce</span>(<span class="ruby-identifier">max</span>(<span class="ruby-identifier">pk</span>)<span class="ruby-operator">+</span><span class="ruby-identifier">seq_ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">increment_by</span>), <span class="ruby-identifier">seq_ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">min_value</span>))), <span class="ruby-keyword">false</span>)}&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-rollback_prepared_transaction'>
<a name='method-i-rollback_prepared_transaction'></a>
<div class='synopsis'>
<span class='name'>rollback_prepared_transaction</span>
<span class='arguments'>(transaction_id, opts=OPTS)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-rollback_prepared_transaction-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-rollback_prepared_transaction-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 647</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rollback_prepared_transaction</span>(<span class="ruby-identifier">transaction_id</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">run</span>(<span class="ruby-node">&quot;ROLLBACK PREPARED #{literal(transaction_id)}&quot;</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-serial_primary_key_options'>
<a name='method-i-serial_primary_key_options'></a>
<div class='synopsis'>
<span class='name'>serial_primary_key_options</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL uses SERIAL psuedo-type instead of AUTOINCREMENT for managing
incrementing primary keys.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-serial_primary_key_options-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-serial_primary_key_options-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 653</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">serial_primary_key_options</span>&#x000A;  <span class="ruby-identifier">auto_increment_key</span> = <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">100002</span> <span class="ruby-operator">?</span> <span class="ruby-value">:identity</span> <span class="ruby-operator">:</span> <span class="ruby-value">:serial</span>&#x000A;  {<span class="ruby-value">:primary_key</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">auto_increment_key</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:type</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Integer</span>}&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-server_version'>
<a name='method-i-server_version'></a>
<div class='synopsis'>
<span class='name'>server_version</span>
<span class='arguments'>(server=nil)</span>

</div>
<div class='description'>

<p>The version of the PostgreSQL server, used for determining capability.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-server_version-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-server_version-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 659</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">server_version</span>(<span class="ruby-identifier">server</span>=<span class="ruby-keyword">nil</span>)&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@server_version</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@server_version</span>&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">dataset</span>&#x000A;  <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">server</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server</span>&#x000A;  <span class="ruby-ivar">@server_version</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">with_sql</span>(<span class="ruby-string">&quot;SELECT CAST(current_setting(&#39;server_version_num&#39;) AS integer) AS v&quot;</span>).<span class="ruby-identifier">single_value</span> <span class="ruby-keyword">rescue</span> <span class="ruby-value">0</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_create_table_if_not_exists-3F'>
<a name='method-i-supports_create_table_if_not_exists-3F'></a>
<div class='synopsis'>
<span class='name'>supports_create_table_if_not_exists?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports CREATE TABLE IF NOT EXISTS on 9.1+</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_create_table_if_not_exists-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_create_table_if_not_exists-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 667</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_create_table_if_not_exists?</span>&#x000A;  <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90100</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_deferrable_constraints-3F'>
<a name='method-i-supports_deferrable_constraints-3F'></a>
<div class='synopsis'>
<span class='name'>supports_deferrable_constraints?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL 9.0+ supports some types of deferrable constraints beyond
foreign key constraints.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_deferrable_constraints-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_deferrable_constraints-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 672</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_deferrable_constraints?</span>&#x000A;  <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90000</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_deferrable_foreign_key_constraints-3F'>
<a name='method-i-supports_deferrable_foreign_key_constraints-3F'></a>
<div class='synopsis'>
<span class='name'>supports_deferrable_foreign_key_constraints?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports deferrable foreign key constraints.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_deferrable_foreign_key_constraints-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_deferrable_foreign_key_constraints-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 677</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_deferrable_foreign_key_constraints?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_drop_table_if_exists-3F'>
<a name='method-i-supports_drop_table_if_exists-3F'></a>
<div class='synopsis'>
<span class='name'>supports_drop_table_if_exists?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports DROP TABLE IF EXISTS</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_drop_table_if_exists-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_drop_table_if_exists-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 682</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_drop_table_if_exists?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_partial_indexes-3F'>
<a name='method-i-supports_partial_indexes-3F'></a>
<div class='synopsis'>
<span class='name'>supports_partial_indexes?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports partial indexes.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_partial_indexes-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_partial_indexes-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 687</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_partial_indexes?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_prepared_transactions-3F'>
<a name='method-i-supports_prepared_transactions-3F'></a>
<div class='synopsis'>
<span class='name'>supports_prepared_transactions?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports prepared transactions (two-phase commit) if
max_prepared_transactions is greater than 0.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_prepared_transactions-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_prepared_transactions-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 698</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_prepared_transactions?</span>&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@supports_prepared_transactions</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@supports_prepared_transactions</span>)&#x000A;  <span class="ruby-ivar">@supports_prepared_transactions</span> = <span class="ruby-keyword">self</span>[<span class="ruby-string">&#39;SHOW max_prepared_transactions&#39;</span>].<span class="ruby-identifier">get</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_savepoints-3F'>
<a name='method-i-supports_savepoints-3F'></a>
<div class='synopsis'>
<span class='name'>supports_savepoints?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports savepoints</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_savepoints-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_savepoints-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 704</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_savepoints?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_transaction_isolation_levels-3F'>
<a name='method-i-supports_transaction_isolation_levels-3F'></a>
<div class='synopsis'>
<span class='name'>supports_transaction_isolation_levels?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports transaction isolation levels</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_transaction_isolation_levels-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_transaction_isolation_levels-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 709</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_transaction_isolation_levels?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_transactional_ddl-3F'>
<a name='method-i-supports_transactional_ddl-3F'></a>
<div class='synopsis'>
<span class='name'>supports_transactional_ddl?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports transaction DDL statements.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_transactional_ddl-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_transactional_ddl-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 714</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_transactional_ddl?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_trigger_conditions-3F'>
<a name='method-i-supports_trigger_conditions-3F'></a>
<div class='synopsis'>
<span class='name'>supports_trigger_conditions?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL 9.0+ supports trigger conditions.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_trigger_conditions-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_trigger_conditions-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 692</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_trigger_conditions?</span>&#x000A;  <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90000</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-tables'>
<a name='method-i-tables'></a>
<div class='synopsis'>
<span class='name'>tables</span>
<span class='arguments'>(opts=OPTS, &block)</span>

</div>
<div class='description'>

<p>Array of symbols specifying table names in the current database. The
dataset used is yielded to the block if one is provided, otherwise, an
array of symbols of table names is returned.</p>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:qualify </td><td>
<p>Return the tables as Sequel::SQL::QualifiedIdentifier instances, using the
schema the table is located in as the qualifier.</p>
</td></tr><tr><td class='label'>:schema </td><td>
<p>The schema to search</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>The server to use</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-tables-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-tables-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 727</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tables</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-identifier">pg_class_relname</span>(<span class="ruby-string">&#39;r&#39;</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-type_supported-3F'>
<a name='method-i-type_supported-3F'></a>
<div class='synopsis'>
<span class='name'>type_supported?</span>
<span class='arguments'>(type)</span>

</div>
<div class='description'>

<p>Check whether the given type name string/symbol (e.g. :hstore) is supported
by the database.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-type_supported-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-type_supported-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 733</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">type_supported?</span>(<span class="ruby-identifier">type</span>)&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@supported_types</span>[<span class="ruby-identifier">type</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@supported_types</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">type</span>)}&#x000A;  <span class="ruby-identifier">supported</span> = <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_type</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:typtype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;b&#39;</span>, <span class="ruby-value">:typname</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@supported_types</span>[<span class="ruby-identifier">type</span>] = <span class="ruby-identifier">supported</span>}&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-values'>
<a name='method-i-values'></a>
<div class='synopsis'>
<span class='name'>values</span>
<span class='arguments'>(v)</span>

</div>
<div class='description'>

<p>Creates a dataset that uses the VALUES clause:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">values</span>([[<span class="ruby-value">1</span>, <span class="ruby-value">2</span>], [<span class="ruby-value">3</span>, <span class="ruby-value">4</span>]])&#x000A;<span class="ruby-comment"># VALUES ((1, 2), (3, 4))</span>&#x000A;&#x000A;<span class="ruby-constant">DB</span>.<span class="ruby-identifier">values</span>([[<span class="ruby-value">1</span>, <span class="ruby-value">2</span>], [<span class="ruby-value">3</span>, <span class="ruby-value">4</span>]]).<span class="ruby-identifier">order</span>(<span class="ruby-value">:column2</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-value">1</span>, <span class="ruby-value">1</span>)&#x000A;<span class="ruby-comment"># VALUES ((1, 2), (3, 4)) ORDER BY column2 LIMIT 1 OFFSET 1</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-values-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-values-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 746</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">values</span>(<span class="ruby-identifier">v</span>)&#x000A;  <span class="ruby-ivar">@default_dataset</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-value">:values</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">v</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-views'>
<a name='method-i-views'></a>
<div class='synopsis'>
<span class='name'>views</span>
<span class='arguments'>(opts=OPTS)</span>

</div>
<div class='description'>

<p>Array of symbols specifying view names in the current database.</p>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:materialized </td><td>
<p>Return materialized views</p>
</td></tr><tr><td class='label'>:qualify </td><td>
<p>Return the views as Sequel::SQL::QualifiedIdentifier instances, using the
schema the view is located in as the qualifier.</p>
</td></tr><tr><td class='label'>:schema </td><td>
<p>The schema to search</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>The server to use</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-views-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-views-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb, line 758</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">views</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">relkind</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:materialized</span>] <span class="ruby-operator">?</span> <span class="ruby-string">&#39;m&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;v&#39;</span>&#x000A;  <span class="ruby-identifier">pg_class_relname</span>(<span class="ruby-identifier">relkind</span>, <span class="ruby-identifier">opts</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
