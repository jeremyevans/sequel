<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Sequel::Postgres::DatabaseMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Sequel::Postgres::DatabaseMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../files/lib/sequel/adapters/shared/postgres_rb.html">lib/sequel/adapters/shared/postgres.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-add_conversion_proc">add_conversion_proc</a></li>
<li><a href="#method-i-add_named_conversion_proc">add_named_conversion_proc</a></li>
<li><a href="#method-i-check_constraints">check_constraints</a></li>
<li><a href="#method-i-commit_prepared_transaction">commit_prepared_transaction</a></li>
<li><a href="#attribute-i-conversion_procs">conversion_procs</a></li>
<li><a href="#method-i-convert_serial_to_identity">convert_serial_to_identity</a></li>
<li><a href="#method-i-create_function">create_function</a></li>
<li><a href="#method-i-create_language">create_language</a></li>
<li><a href="#method-i-create_schema">create_schema</a></li>
<li><a href="#method-i-create_table">create_table</a></li>
<li><a href="#method-i-create_table-3F">create_table?</a></li>
<li><a href="#method-i-create_trigger">create_trigger</a></li>
<li><a href="#method-i-database_type">database_type</a></li>
<li><a href="#method-i-do">do</a></li>
<li><a href="#method-i-drop_function">drop_function</a></li>
<li><a href="#method-i-drop_language">drop_language</a></li>
<li><a href="#method-i-drop_schema">drop_schema</a></li>
<li><a href="#method-i-drop_trigger">drop_trigger</a></li>
<li><a href="#method-i-foreign_key_list">foreign_key_list</a></li>
<li><a href="#method-i-freeze">freeze</a></li>
<li><a href="#method-i-indexes">indexes</a></li>
<li><a href="#method-i-locks">locks</a></li>
<li><a href="#method-i-notify">notify</a></li>
<li><a href="#method-i-primary_key">primary_key</a></li>
<li><a href="#method-i-primary_key_sequence">primary_key_sequence</a></li>
<li><a href="#method-i-refresh_view">refresh_view</a></li>
<li><a href="#method-i-reset_primary_key_sequence">reset_primary_key_sequence</a></li>
<li><a href="#method-i-rollback_prepared_transaction">rollback_prepared_transaction</a></li>
<li><a href="#method-i-serial_primary_key_options">serial_primary_key_options</a></li>
<li><a href="#method-i-server_version">server_version</a></li>
<li><a href="#method-i-supports_create_table_if_not_exists-3F">supports_create_table_if_not_exists?</a></li>
<li><a href="#method-i-supports_deferrable_constraints-3F">supports_deferrable_constraints?</a></li>
<li><a href="#method-i-supports_deferrable_foreign_key_constraints-3F">supports_deferrable_foreign_key_constraints?</a></li>
<li><a href="#method-i-supports_drop_table_if_exists-3F">supports_drop_table_if_exists?</a></li>
<li><a href="#method-i-supports_partial_indexes-3F">supports_partial_indexes?</a></li>
<li><a href="#method-i-supports_prepared_transactions-3F">supports_prepared_transactions?</a></li>
<li><a href="#method-i-supports_savepoints-3F">supports_savepoints?</a></li>
<li><a href="#method-i-supports_transaction_isolation_levels-3F">supports_transaction_isolation_levels?</a></li>
<li><a href="#method-i-supports_transactional_ddl-3F">supports_transactional_ddl?</a></li>
<li><a href="#method-i-supports_trigger_conditions-3F">supports_trigger_conditions?</a></li>
<li><a href="#method-i-tables">tables</a></li>
<li><a href="#method-i-type_supported-3F">type_supported?</a></li>
<li><a href="#method-i-values">values</a></li>
<li><a href="#method-i-views">views</a></li>
</ol>
</div>
<div id='context'>
<div id='includes'>
<h2>Included modules</h2>
<ol>
<li><a href="../UnmodifiedIdentifiers/DatabaseMethods.html">UnmodifiedIdentifiers::DatabaseMethods</a></li>
</ol>
</div>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>DATABASE_ERROR_REGEXPS</td>
<td>=</td>
<td class='context-item-value'>[
# Add this check first, since otherwise it's possible for users to control
# which exception class is generated.
[/invalid input syntax/, DatabaseError],
[/duplicate key value violates unique constraint/, UniqueConstraintViolation],
[/violates foreign key constraint/, ForeignKeyConstraintViolation],
[/violates check constraint/, CheckConstraintViolation],
[/violates not-null constraint/, NotNullConstraintViolation],
[/conflicting key value violates exclusion constraint/, ExclusionConstraintViolation],
[/could not serialize access/, SerializationFailure],
[/could not obtain lock on row in relation/, DatabaseLockTimeout],
].freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>FOREIGN_KEY_LIST_ON_DELETE_MAP</td>
<td>=</td>
<td class='context-item-value'>{'a'=>:no_action, 'r'=>:restrict, 'c'=>:cascade, 'n'=>:set_null, 'd'=>:set_default}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>ON_COMMIT</td>
<td>=</td>
<td class='context-item-value'>{:drop => 'DROP', :delete_rows => 'DELETE ROWS', :preserve_rows => 'PRESERVE ROWS'}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>SELECT_CUSTOM_SEQUENCE_SQL</td>
<td>=</td>
<td class='context-item-value'>(<<-end_sql
SELECT name.nspname AS "schema",
CASE
WHEN split_part(pg_get_expr(def.adbin, attr.attrelid), '''', 2) ~ '.' THEN
substr(split_part(pg_get_expr(def.adbin, attr.attrelid), '''', 2),
strpos(split_part(pg_get_expr(def.adbin, attr.attrelid), '''', 2), '.')+1)
ELSE split_part(pg_get_expr(def.adbin, attr.attrelid), '''', 2)
END AS "sequence"
FROM pg_class t
JOIN pg_namespace  name ON (t.relnamespace = name.oid)
JOIN pg_attribute  attr ON (t.oid = attrelid)
JOIN pg_attrdef    def  ON (adrelid = attrelid AND adnum = attnum)
JOIN pg_constraint cons ON (conrelid = adrelid AND adnum = conkey[1])
WHERE cons.contype = 'p'
AND pg_get_expr(def.adbin, attr.attrelid) ~* 'nextval'
end_sql
).strip.gsub(/\s+/, ' ').freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'>
<p>SQL fragment for custom sequences (ones not created by serial primary key), Returning the schema and literal form of the sequence name, by parsing the column defaults table.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>SELECT_PK_SQL</td>
<td>=</td>
<td class='context-item-value'>(<<-end_sql
SELECT pg_attribute.attname AS pk
FROM pg_class, pg_attribute, pg_index, pg_namespace
WHERE pg_class.oid = pg_attribute.attrelid
AND pg_class.relnamespace  = pg_namespace.oid
AND pg_class.oid = pg_index.indrelid
AND pg_index.indkey[0] = pg_attribute.attnum
AND pg_index.indisprimary = 't'
end_sql
).strip.gsub(/\s+/, ' ').freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'>
<p>SQL fragment for determining primary key column for the given table.  Only returns the first primary key if the table has a composite primary key.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>SELECT_SERIAL_SEQUENCE_SQL</td>
<td>=</td>
<td class='context-item-value'>(<<-end_sql
SELECT  name.nspname AS "schema", seq.relname AS "sequence"
FROM pg_class seq, pg_attribute attr, pg_depend dep,
pg_namespace name, pg_constraint cons, pg_class t
WHERE seq.oid = dep.objid
AND seq.relnamespace  = name.oid
AND seq.relkind = 'S'
AND attr.attrelid = dep.refobjid
AND attr.attnum = dep.refobjsubid
AND attr.attrelid = cons.conrelid
AND attr.attnum = cons.conkey[1]
AND attr.attrelid = t.oid
AND cons.contype = 'p'
end_sql
).strip.gsub(/\s+/, ' ').freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'>
<p>SQL fragment for getting sequence associated with table’s primary key, assuming it was a serial primary key column.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>VALID_CLIENT_MIN_MESSAGES</td>
<td>=</td>
<td class='context-item-value'>%w'DEBUG5 DEBUG4 DEBUG3 DEBUG2 DEBUG1 LOG NOTICE WARNING ERROR FATAL PANIC'.freeze.each(&:freeze)</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-conversion_procs'>conversion_procs</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'>
<p>A hash of conversion procs, keyed by type integer (oid) and having callable values for the conversion proc for that type.</p>
</td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-add_conversion_proc'>
<a name='method-i-add_conversion_proc'></a>
<div class='synopsis'>
<span class='name'>add_conversion_proc</span><span class='arguments'>(oid, callable=nil, &block)</span>

</div>
<div class='description'>

<p>Set a conversion proc for the given oid.  The callable can be passed either as a argument or a block.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-add_conversion_proc-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-add_conversion_proc-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">295</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_conversion_proc</span>(<span class="ruby-identifier">oid</span>, <span class="ruby-identifier">callable</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">296</span>   <span class="ruby-identifier">conversion_procs</span>[<span class="ruby-identifier">oid</span>] = <span class="ruby-identifier">callable</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>
<span class="line-num">297</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-add_named_conversion_proc'>
<a name='method-i-add_named_conversion_proc'></a>
<div class='synopsis'>
<span class='name'>add_named_conversion_proc</span><span class='arguments'>(name, &block)</span>

</div>
<div class='description'>

<p>Add a conversion proc for a named type, using the given block. This should be used for types without fixed OIDs, which includes all types that are not included in a default PostgreSQL installation.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-add_named_conversion_proc-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-add_named_conversion_proc-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">302</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_named_conversion_proc</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">303</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">oid</span> = <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_type</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:typtype</span><span class="ruby-operator">=&gt;</span>[<span class="ruby-string">&#39;b&#39;</span>, <span class="ruby-string">&#39;e&#39;</span>], <span class="ruby-value">:typname</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">get</span>(<span class="ruby-value">:oid</span>)
<span class="line-num">304</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;No matching type in pg_type for #{name.inspect}&quot;</span>
<span class="line-num">305</span>   <span class="ruby-keyword">end</span>
<span class="line-num">306</span>   <span class="ruby-identifier">add_conversion_proc</span>(<span class="ruby-identifier">oid</span>, <span class="ruby-identifier">block</span>)
<span class="line-num">307</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-check_constraints'>
<a name='method-i-check_constraints'></a>
<div class='synopsis'>
<span class='name'>check_constraints</span><span class='arguments'>(table)</span>

</div>
<div class='description'>

<p>A hash of metadata for CHECK constraints on the table. Keys are CHECK constraint name symbols.  Values are hashes with the following keys:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:definition </td><td>
<p>An SQL fragment for the definition of the constraint</p>
</td></tr><tr><td class='label'>:columns </td><td>
<p>An array of column symbols for the columns referenced in the constraint, can be an empty array if the database cannot deteremine the column symbols.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-check_constraints-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-check_constraints-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">318</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">check_constraints</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">319</span>   <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>
<span class="line-num">320</span> 
<span class="line-num">321</span>   <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">metadata_dataset</span>.
<span class="line-num">322</span>     <span class="ruby-identifier">from</span>{<span class="ruby-identifier">pg_constraint</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:co</span>)}.
<span class="line-num">323</span>     <span class="ruby-identifier">left_join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_attribute</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:att</span>), <span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:conrelid</span>, <span class="ruby-value">:attnum</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:co</span>][<span class="ruby-value">:conkey</span>])).
<span class="line-num">324</span>     <span class="ruby-identifier">where</span>(<span class="ruby-value">:conrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>), <span class="ruby-value">:contype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;c&#39;</span>).
<span class="line-num">325</span>     <span class="ruby-identifier">select</span>{[<span class="ruby-identifier">co</span>[<span class="ruby-value">:conname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:constraint</span>), <span class="ruby-identifier">att</span>[<span class="ruby-value">:attname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:column</span>), <span class="ruby-identifier">pg_get_constraintdef</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:oid</span>]).<span class="ruby-identifier">as</span>(<span class="ruby-value">:definition</span>)]}
<span class="line-num">326</span> 
<span class="line-num">327</span>   <span class="ruby-identifier">hash</span> = {}
<span class="line-num">328</span>   <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
<span class="line-num">329</span>     <span class="ruby-identifier">constraint</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:constraint</span>])
<span class="line-num">330</span>     <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">constraint</span>] <span class="ruby-operator">||=</span> {<span class="ruby-value">:definition</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">row</span>[<span class="ruby-value">:definition</span>], <span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span>[]}
<span class="line-num">331</span>     <span class="ruby-identifier">entry</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>]
<span class="line-num">332</span>   <span class="ruby-keyword">end</span>
<span class="line-num">333</span>   
<span class="line-num">334</span>   <span class="ruby-identifier">hash</span>
<span class="line-num">335</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-commit_prepared_transaction'>
<a name='method-i-commit_prepared_transaction'></a>
<div class='synopsis'>
<span class='name'>commit_prepared_transaction</span><span class='arguments'>(transaction_id, opts=OPTS)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-commit_prepared_transaction-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-commit_prepared_transaction-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">309</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">commit_prepared_transaction</span>(<span class="ruby-identifier">transaction_id</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">310</span>   <span class="ruby-identifier">run</span>(<span class="ruby-node">&quot;COMMIT PREPARED #{literal(transaction_id)}&quot;</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">311</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-convert_serial_to_identity'>
<a name='method-i-convert_serial_to_identity'></a>
<div class='synopsis'>
<span class='name'>convert_serial_to_identity</span><span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Convert the first primary key column in the <code>table</code> from being a serial column to being an identity column. If the column is already an identity column, assume it was already converted and make no changes.</p>

<p>Only supported on PostgreSQL 10.2+, since on those versions <a href="../../Sequel.html"><code>Sequel</code></a> will use identity columns instead of serial columns for auto incrementing primary keys. Only supported when running as a superuser, since regular users cannot modify system tables, and there is no way to keep an existing sequence when changing an existing column to be an identity column.</p>

<p>This method can raise an exception in at least the following cases where it may otherwise succeed (there may be additional cases not listed here):</p>
<ul><li>
<p>The serial column was added after table creation using PostgreSQL &lt;7.3</p>
</li><li>
<p>A regular index also exists on the column (such an index can probably be dropped as the primary key index should suffice)</p>
</li></ul>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:column </td><td>
<p>Specify the column to convert instead of using the first primary key column</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>Run the SQL on the given server</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-convert_serial_to_identity-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-convert_serial_to_identity-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">355</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">convert_serial_to_identity</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">356</span>   <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;convert_serial_to_identity is only supported on PostgreSQL 10.2+&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">100002</span>
<span class="line-num">357</span> 
<span class="line-num">358</span>   <span class="ruby-identifier">server</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>]
<span class="line-num">359</span>   <span class="ruby-identifier">server_hash</span> = <span class="ruby-identifier">server</span> <span class="ruby-operator">?</span> {<span class="ruby-value">:server</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">server</span>} <span class="ruby-operator">:</span> <span class="ruby-constant">OPTS</span>
<span class="line-num">360</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">dataset</span>
<span class="line-num">361</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">server</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server</span>
<span class="line-num">362</span> 
<span class="line-num">363</span>   <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;convert_serial_to_identity requires superuser permissions&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">get</span>{<span class="ruby-identifier">current_setting</span>(<span class="ruby-string">&#39;is_superuser&#39;</span>)} <span class="ruby-operator">==</span> <span class="ruby-string">&#39;on&#39;</span>
<span class="line-num">364</span> 
<span class="line-num">365</span>   <span class="ruby-identifier">table_oid</span> = <span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">366</span>   <span class="ruby-identifier">im</span> = <span class="ruby-identifier">input_identifier_meth</span>
<span class="line-num">367</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">column</span> = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:column</span>] <span class="ruby-operator">||</span> ((<span class="ruby-identifier">sch</span> = <span class="ruby-identifier">schema</span>(<span class="ruby-identifier">table</span>).<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">sc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sc</span>[<span class="ruby-value">:primary_key</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sc</span>[<span class="ruby-value">:auto_increment</span>]}) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sch</span>[<span class="ruby-value">0</span>]))
<span class="line-num">368</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;could not determine column to convert from serial to identity automatically&quot;</span>
<span class="line-num">369</span>   <span class="ruby-keyword">end</span>
<span class="line-num">370</span>   <span class="ruby-identifier">column</span> = <span class="ruby-identifier">im</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">column</span>)
<span class="line-num">371</span> 
<span class="line-num">372</span>   <span class="ruby-identifier">column_num</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_attribute</span>).
<span class="line-num">373</span>     <span class="ruby-identifier">where</span>(<span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table_oid</span>, <span class="ruby-value">:attname</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">column</span>).
<span class="line-num">374</span>     <span class="ruby-identifier">get</span>(<span class="ruby-value">:attnum</span>)
<span class="line-num">375</span> 
<span class="line-num">376</span>   <span class="ruby-identifier">pg_class</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">cast</span>(<span class="ruby-string">&#39;pg_class&#39;</span>, <span class="ruby-value">:regclass</span>)
<span class="line-num">377</span>   <span class="ruby-identifier">res</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_depend</span>).
<span class="line-num">378</span>     <span class="ruby-identifier">where</span>(<span class="ruby-value">:refclassid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">pg_class</span>, <span class="ruby-value">:refobjid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table_oid</span>, <span class="ruby-value">:refobjsubid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">column_num</span>, <span class="ruby-value">:classid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">pg_class</span>, <span class="ruby-value">:objsubid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">0</span>, <span class="ruby-value">:deptype</span><span class="ruby-operator">=&gt;</span><span class="ruby-node">%w&#39;a i&#39;</span>).
<span class="line-num">379</span>     <span class="ruby-identifier">select_map</span>([<span class="ruby-value">:objid</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>({<span class="ruby-value">:deptype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;i&#39;</span>}, <span class="ruby-value">:v</span>)])
<span class="line-num">380</span> 
<span class="line-num">381</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">length</span>
<span class="line-num">382</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">0</span>
<span class="line-num">383</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;unable to find related sequence when converting serial to identity&quot;</span>
<span class="line-num">384</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">1</span>
<span class="line-num">385</span>     <span class="ruby-identifier">seq_oid</span>, <span class="ruby-identifier">already_identity</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">first</span>
<span class="line-num">386</span>   <span class="ruby-keyword">else</span>
<span class="line-num">387</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;more than one linked sequence found when converting serial to identity&quot;</span>
<span class="line-num">388</span>   <span class="ruby-keyword">end</span>
<span class="line-num">389</span> 
<span class="line-num">390</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">already_identity</span>
<span class="line-num">391</span> 
<span class="line-num">392</span>   <span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">server_hash</span>) <span class="ruby-keyword">do</span>
<span class="line-num">393</span>     <span class="ruby-identifier">run</span>(<span class="ruby-node">&quot;ALTER TABLE #{quote_schema_table(table)} ALTER COLUMN #{quote_identifier(column)} DROP DEFAULT&quot;</span>, <span class="ruby-identifier">server_hash</span>)
<span class="line-num">394</span> 
<span class="line-num">395</span>     <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_depend</span>).
<span class="line-num">396</span>       <span class="ruby-identifier">where</span>(<span class="ruby-value">:classid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">pg_class</span>, <span class="ruby-value">:objid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">seq_oid</span>, <span class="ruby-value">:objsubid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">0</span>, <span class="ruby-value">:deptype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;a&#39;</span>).
<span class="line-num">397</span>       <span class="ruby-identifier">update</span>(<span class="ruby-value">:deptype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;i&#39;</span>)
<span class="line-num">398</span> 
<span class="line-num">399</span>     <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_attribute</span>).
<span class="line-num">400</span>       <span class="ruby-identifier">where</span>(<span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table_oid</span>, <span class="ruby-value">:attname</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">column</span>).
<span class="line-num">401</span>       <span class="ruby-identifier">update</span>(<span class="ruby-value">:attidentity</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;d&#39;</span>)
<span class="line-num">402</span>   <span class="ruby-keyword">end</span>
<span class="line-num">403</span> 
<span class="line-num">404</span>   <span class="ruby-identifier">remove_cached_schema</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">405</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">406</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_function'>
<a name='method-i-create_function'></a>
<div class='synopsis'>
<span class='name'>create_function</span><span class='arguments'>(name, definition, opts=OPTS)</span>

</div>
<div class='description'>

<p>Creates the function in the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>name of the function to create</p>
</td></tr><tr><td class='label'>definition </td><td>
<p>string definition of the function, or object file for a dynamically loaded C function.</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:args </td><td>
<p>function arguments, can be either a symbol or string specifying a type or an array of 1-3 elements:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>1 </td><td>
<p>argument data type</p>
</td></tr><tr><td class='label'>2 </td><td>
<p>argument name</p>
</td></tr><tr><td class='label'>3 </td><td>
<p>argument mode (e.g. in, out, inout)</p>
</td></tr></tbody></table>
</td></tr><tr><td class='label'>:behavior </td><td>
<p>Should be IMMUTABLE, STABLE, or VOLATILE.  PostgreSQL assumes VOLATILE by default.</p>
</td></tr><tr><td class='label'>:parallel </td><td>
<p>The thread safety attribute of the function. Should be SAFE, UNSAFE, RESTRICTED. PostgreSQL assumes UNSAFE by default.</p>
</td></tr><tr><td class='label'>:cost </td><td>
<p>The estimated cost of the function, used by the query planner.</p>
</td></tr><tr><td class='label'>:language </td><td>
<p>The language the function uses.  SQL is the default.</p>
</td></tr><tr><td class='label'>:link_symbol </td><td>
<p>For a dynamically loaded see function, the function’s link symbol if different from the definition argument.</p>
</td></tr><tr><td class='label'>:returns </td><td>
<p>The data type returned by the function.  If you are using OUT or INOUT argument modes, this is ignored. Otherwise, if this is not specified, void is used by default to specify the function is not supposed to return a value.</p>
</td></tr><tr><td class='label'>:rows </td><td>
<p>The estimated number of rows the function will return.  Only use if the function returns SETOF something.</p>
</td></tr><tr><td class='label'>:security_definer </td><td>
<p>Makes the privileges of the function the same as the privileges of the user who defined the function instead of the privileges of the user who runs the function.  There are security implications when doing this, see the PostgreSQL documentation.</p>
</td></tr><tr><td class='label'>:set </td><td>
<p>Configuration variables to set while the function is being run, can be a hash or an array of two pairs.  search_path is often used here if :security_definer is used.</p>
</td></tr><tr><td class='label'>:strict </td><td>
<p>Makes the function return NULL when any argument is NULL.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_function-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_function-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">429</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_function</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">definition</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">430</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_function_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">definition</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">431</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_language'>
<a name='method-i-create_language'></a>
<div class='synopsis'>
<span class='name'>create_language</span><span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Create the procedural language in the database. Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>Name of the procedural language (e.g. plpgsql)</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:handler </td><td>
<p>The name of a previously registered function used as a call handler for this language.</p>
</td></tr><tr><td class='label'>:replace </td><td>
<p>Replace the installed language if it already exists (on PostgreSQL 9.0+).</p>
</td></tr><tr><td class='label'>:trusted </td><td>
<p>Marks the language being created as trusted, allowing unprivileged users to create functions using this language.</p>
</td></tr><tr><td class='label'>:validator </td><td>
<p>The name of previously registered function used as a validator of functions defined in this language.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_language-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_language-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">440</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_language</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">441</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_language_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">442</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_schema'>
<a name='method-i-create_schema'></a>
<div class='synopsis'>
<span class='name'>create_schema</span><span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Create a schema in the database. Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>Name of the schema (e.g. admin)</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:if_not_exists </td><td>
<p>Don’t raise an error if the schema already exists (PostgreSQL 9.3+)</p>
</td></tr><tr><td class='label'>:owner </td><td>
<p>The owner to set for the schema (defaults to current user if not specified)</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_schema-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_schema-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">449</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_schema</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">450</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_schema_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">451</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_table'>
<a name='method-i-create_table'></a>
<div class='synopsis'>
<span class='name'>create_table</span><span class='arguments'>(name, options=OPTS, &block)</span>

</div>
<div class='description'>

<p>Support partitions of tables using the :partition_of option.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_table-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_table-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">454</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_table</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">options</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">455</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:partition_of</span>]
<span class="line-num">456</span>     <span class="ruby-identifier">create_partition_of_table_from_generator</span>(<span class="ruby-identifier">name</span>, <span class="ruby-constant">CreatePartitionOfTableGenerator</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>), <span class="ruby-identifier">options</span>)
<span class="line-num">457</span>     <span class="ruby-keyword">return</span>
<span class="line-num">458</span>   <span class="ruby-keyword">end</span>
<span class="line-num">459</span> 
<span class="line-num">460</span>   <span class="ruby-keyword">super</span>
<span class="line-num">461</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_table-3F'>
<a name='method-i-create_table-3F'></a>
<div class='synopsis'>
<span class='name'>create_table?</span><span class='arguments'>(name, options=OPTS, &block)</span>

</div>
<div class='description'>

<p>Support partitions of tables using the :partition_of option.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_table-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_table-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">464</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_table?</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">options</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">465</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:partition_of</span>]
<span class="line-num">466</span>     <span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">:if_not_exists</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">467</span>     <span class="ruby-keyword">return</span>
<span class="line-num">468</span>   <span class="ruby-keyword">end</span>
<span class="line-num">469</span> 
<span class="line-num">470</span>   <span class="ruby-keyword">super</span>
<span class="line-num">471</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-create_trigger'>
<a name='method-i-create_trigger'></a>
<div class='synopsis'>
<span class='name'>create_trigger</span><span class='arguments'>(table, name, function, opts=OPTS)</span>

</div>
<div class='description'>

<p>Create a trigger in the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>table </td><td>
<p>the table on which this trigger operates</p>
</td></tr><tr><td class='label'>name </td><td>
<p>the name of this trigger</p>
</td></tr><tr><td class='label'>function </td><td>
<p>the function to call for this trigger, which should return type trigger.</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:after </td><td>
<p>Calls the trigger after execution instead of before.</p>
</td></tr><tr><td class='label'>:args </td><td>
<p>An argument or array of arguments to pass to the function.</p>
</td></tr><tr><td class='label'>:each_row </td><td>
<p>Calls the trigger for each row instead of for each statement.</p>
</td></tr><tr><td class='label'>:events </td><td>
<p>Can be :insert, :update, :delete, or an array of any of those. Calls the trigger whenever that type of statement is used.  By default, the trigger is called for insert, update, or delete.</p>
</td></tr><tr><td class='label'>:replace </td><td>
<p>Replace the trigger with the same name if it already exists (PostgreSQL 14+).</p>
</td></tr><tr><td class='label'>:when </td><td>
<p>A filter to use for the trigger</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-create_trigger-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-create_trigger-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">485</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_trigger</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">function</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">486</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">create_trigger_sql</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">function</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">487</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-database_type'>
<a name='method-i-database_type'></a>
<div class='synopsis'>
<span class='name'>database_type</span><span class='arguments'>()</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-database_type-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-database_type-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">489</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">database_type</span>
<span class="line-num">490</span>   <span class="ruby-value">:postgres</span>
<span class="line-num">491</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-do'>
<a name='method-i-do'></a>
<div class='synopsis'>
<span class='name'>do</span><span class='arguments'>(code, opts=OPTS)</span>

</div>
<div class='description'>

<p>Use PostgreSQL’s DO syntax to execute an anonymous code block.  The code should be the literal code string to use in the underlying procedural language.  Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:language </td><td>
<p>The procedural language the code is written in.  The PostgreSQL default is plpgsql.  Can be specified as a string or a symbol.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-do-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-do-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">498</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">do</span>(<span class="ruby-identifier ruby-title">code</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">499</span>   <span class="ruby-identifier">language</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:language</span>]
<span class="line-num">500</span>   <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;DO #{&quot;LANGUAGE #{literal(language.to_s)} &quot; if language}#{literal(code)}&quot;</span>
<span class="line-num">501</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-drop_function'>
<a name='method-i-drop_function'></a>
<div class='synopsis'>
<span class='name'>drop_function</span><span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Drops the function from the database. Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>name of the function to drop</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:args </td><td>
<p>The arguments for the function.  See create_function_sql.</p>
</td></tr><tr><td class='label'>:cascade </td><td>
<p>Drop other objects depending on this function.</p>
</td></tr><tr><td class='label'>:if_exists </td><td>
<p>Don’t raise an error if the function doesn’t exist.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-drop_function-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-drop_function-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">509</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">drop_function</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">510</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_function_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">511</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-drop_language'>
<a name='method-i-drop_language'></a>
<div class='synopsis'>
<span class='name'>drop_language</span><span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Drops a procedural language from the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>name of the procedural language to drop</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:cascade </td><td>
<p>Drop other objects depending on this function.</p>
</td></tr><tr><td class='label'>:if_exists </td><td>
<p>Don’t raise an error if the function doesn’t exist.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-drop_language-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-drop_language-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">518</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">drop_language</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">519</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_language_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">520</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-drop_schema'>
<a name='method-i-drop_schema'></a>
<div class='synopsis'>
<span class='name'>drop_schema</span><span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Drops a schema from the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>name </td><td>
<p>name of the schema to drop</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:cascade </td><td>
<p>Drop all objects in this schema.</p>
</td></tr><tr><td class='label'>:if_exists </td><td>
<p>Don’t raise an error if the schema doesn’t exist.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-drop_schema-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-drop_schema-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">527</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">drop_schema</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">528</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_schema_sql</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">529</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-drop_trigger'>
<a name='method-i-drop_trigger'></a>
<div class='synopsis'>
<span class='name'>drop_trigger</span><span class='arguments'>(table, name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Drops a trigger from the database.  Arguments:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>table </td><td>
<p>table from which to drop the trigger</p>
</td></tr><tr><td class='label'>name </td><td>
<p>name of the trigger to drop</p>
</td></tr><tr><td class='label'>opts </td><td>
<p>options hash:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:cascade </td><td>
<p>Drop other objects depending on this function.</p>
</td></tr><tr><td class='label'>:if_exists </td><td>
<p>Don’t raise an error if the function doesn’t exist.</p>
</td></tr></tbody></table>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-drop_trigger-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-drop_trigger-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">537</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">drop_trigger</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">538</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">drop_trigger_sql</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">539</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-foreign_key_list'>
<a name='method-i-foreign_key_list'></a>
<div class='synopsis'>
<span class='name'>foreign_key_list</span><span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return full foreign key information using the pg system tables, including :name, :on_delete, :on_update, and :deferrable entries in the hashes.</p>

<p>Supports additional options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:reverse </td><td>
<p>Instead of returning foreign keys in the current table, return foreign keys in other tables that reference the current table.</p>
</td></tr><tr><td class='label'>:schema </td><td>
<p>Set to true to have the :table value in the hashes be a qualified identifier.  Set to false to use a separate :schema value with the related schema.  Defaults to whether the given table argument is a qualified identifier.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-foreign_key_list-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-foreign_key_list-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">551</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">foreign_key_list</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">552</span>   <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>
<span class="line-num">553</span>   <span class="ruby-identifier">schema</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:schema</span>, <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table</span>))
<span class="line-num">554</span>   <span class="ruby-identifier">oid</span> = <span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">555</span>   <span class="ruby-identifier">reverse</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:reverse</span>]
<span class="line-num">556</span> 
<span class="line-num">557</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">reverse</span>
<span class="line-num">558</span>     <span class="ruby-identifier">ctable</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att2</span>]
<span class="line-num">559</span>     <span class="ruby-identifier">cclass</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl2</span>]
<span class="line-num">560</span>     <span class="ruby-identifier">rtable</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att</span>]
<span class="line-num">561</span>     <span class="ruby-identifier">rclass</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl</span>]
<span class="line-num">562</span>   <span class="ruby-keyword">else</span>
<span class="line-num">563</span>     <span class="ruby-identifier">ctable</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att</span>]
<span class="line-num">564</span>     <span class="ruby-identifier">cclass</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl</span>]
<span class="line-num">565</span>     <span class="ruby-identifier">rtable</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att2</span>]
<span class="line-num">566</span>     <span class="ruby-identifier">rclass</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl2</span>]
<span class="line-num">567</span>   <span class="ruby-keyword">end</span>
<span class="line-num">568</span> 
<span class="line-num">569</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90500</span>
<span class="line-num">570</span>     <span class="ruby-identifier">cpos</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">expr</span>{<span class="ruby-identifier">array_position</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:conkey</span>], <span class="ruby-identifier">ctable</span>[<span class="ruby-value">:attnum</span>])}
<span class="line-num">571</span>     <span class="ruby-identifier">rpos</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">expr</span>{<span class="ruby-identifier">array_position</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:confkey</span>], <span class="ruby-identifier">rtable</span>[<span class="ruby-value">:attnum</span>])}
<span class="line-num">572</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">573</span>   <span class="ruby-keyword">else</span>
<span class="line-num">574</span>     <span class="ruby-identifier">range</span> = <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">32</span>
<span class="line-num">575</span>     <span class="ruby-identifier">cpos</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">expr</span>{<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:conkey</span>], [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-identifier">ctable</span>[<span class="ruby-value">:attnum</span>])}
<span class="line-num">576</span>     <span class="ruby-identifier">rpos</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">expr</span>{<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">co</span>[<span class="ruby-value">:confkey</span>], [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-identifier">rtable</span>[<span class="ruby-value">:attnum</span>])}
<span class="line-num">577</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">578</span>   <span class="ruby-keyword">end</span>
<span class="line-num">579</span> 
<span class="line-num">580</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">metadata_dataset</span>.
<span class="line-num">581</span>     <span class="ruby-identifier">from</span>{<span class="ruby-identifier">pg_constraint</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:co</span>)}.
<span class="line-num">582</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_class</span>].<span class="ruby-identifier">as</span>(<span class="ruby-identifier">cclass</span>), <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:conrelid</span>).
<span class="line-num">583</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_attribute</span>].<span class="ruby-identifier">as</span>(<span class="ruby-identifier">ctable</span>), <span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:oid</span>, <span class="ruby-value">:attnum</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:co</span>][<span class="ruby-value">:conkey</span>])).
<span class="line-num">584</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_class</span>].<span class="ruby-identifier">as</span>(<span class="ruby-identifier">rclass</span>), <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:co</span>][<span class="ruby-value">:confrelid</span>]).
<span class="line-num">585</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_attribute</span>].<span class="ruby-identifier">as</span>(<span class="ruby-identifier">rtable</span>), <span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:oid</span>, <span class="ruby-value">:attnum</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:co</span>][<span class="ruby-value">:confkey</span>])).
<span class="line-num">586</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_namespace</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:nsp</span>), <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl2</span>][<span class="ruby-value">:relnamespace</span>]).
<span class="line-num">587</span>     <span class="ruby-identifier">order</span>{[<span class="ruby-identifier">co</span>[<span class="ruby-value">:conname</span>], <span class="ruby-identifier">cpos</span>]}.
<span class="line-num">588</span>     <span class="ruby-identifier">where</span>{{
<span class="line-num">589</span>       <span class="ruby-identifier">cl</span>[<span class="ruby-value">:relkind</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-node">%w&#39;r p&#39;</span>,
<span class="line-num">590</span>       <span class="ruby-identifier">co</span>[<span class="ruby-value">:contype</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;f&#39;</span>,
<span class="line-num">591</span>       <span class="ruby-identifier">cl</span>[<span class="ruby-value">:oid</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-identifier">oid</span>,
<span class="line-num">592</span>       <span class="ruby-identifier">cpos</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">rpos</span>
<span class="line-num">593</span>     }}.
<span class="line-num">594</span>     <span class="ruby-identifier">select</span>{[
<span class="line-num">595</span>       <span class="ruby-identifier">co</span>[<span class="ruby-value">:conname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:name</span>),
<span class="line-num">596</span>       <span class="ruby-identifier">ctable</span>[<span class="ruby-value">:attname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:column</span>),
<span class="line-num">597</span>       <span class="ruby-identifier">co</span>[<span class="ruby-value">:confupdtype</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:on_update</span>),
<span class="line-num">598</span>       <span class="ruby-identifier">co</span>[<span class="ruby-value">:confdeltype</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:on_delete</span>),
<span class="line-num">599</span>       <span class="ruby-identifier">cl2</span>[<span class="ruby-value">:relname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:table</span>),
<span class="line-num">600</span>       <span class="ruby-identifier">rtable</span>[<span class="ruby-value">:attname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:refcolumn</span>),
<span class="line-num">601</span>       <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:AND</span>, <span class="ruby-identifier">co</span>[<span class="ruby-value">:condeferrable</span>], <span class="ruby-identifier">co</span>[<span class="ruby-value">:condeferred</span>]).<span class="ruby-identifier">as</span>(<span class="ruby-value">:deferrable</span>),
<span class="line-num">602</span>       <span class="ruby-identifier">nsp</span>[<span class="ruby-value">:nspname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:schema</span>)
<span class="line-num">603</span>     ]}
<span class="line-num">604</span> 
<span class="line-num">605</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">reverse</span>
<span class="line-num">606</span>     <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">order_append</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:nsp</span>][<span class="ruby-value">:nspname</span>], <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:cl2</span>][<span class="ruby-value">:relname</span>])
<span class="line-num">607</span>   <span class="ruby-keyword">end</span>
<span class="line-num">608</span> 
<span class="line-num">609</span>   <span class="ruby-identifier">h</span> = {}
<span class="line-num">610</span>   <span class="ruby-identifier">fklod_map</span> = <span class="ruby-constant">FOREIGN_KEY_LIST_ON_DELETE_MAP</span> 
<span class="line-num">611</span> 
<span class="line-num">612</span>   <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
<span class="line-num">613</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">reverse</span>
<span class="line-num">614</span>       <span class="ruby-identifier">key</span> = [<span class="ruby-identifier">row</span>[<span class="ruby-value">:schema</span>], <span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>], <span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]]
<span class="line-num">615</span>     <span class="ruby-keyword">else</span>
<span class="line-num">616</span>       <span class="ruby-identifier">key</span> = <span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]
<span class="line-num">617</span>     <span class="ruby-keyword">end</span>
<span class="line-num">618</span> 
<span class="line-num">619</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span> = <span class="ruby-identifier">h</span>[<span class="ruby-identifier">key</span>]
<span class="line-num">620</span>       <span class="ruby-identifier">r</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])
<span class="line-num">621</span>       <span class="ruby-identifier">r</span>[<span class="ruby-value">:key</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:refcolumn</span>])
<span class="line-num">622</span>     <span class="ruby-keyword">else</span>
<span class="line-num">623</span>       <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">h</span>[<span class="ruby-identifier">key</span>] = {
<span class="line-num">624</span>         <span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]),
<span class="line-num">625</span>         <span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])],
<span class="line-num">626</span>         <span class="ruby-value">:key</span><span class="ruby-operator">=&gt;</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:refcolumn</span>])],
<span class="line-num">627</span>         <span class="ruby-value">:on_update</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">fklod_map</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:on_update</span>]],
<span class="line-num">628</span>         <span class="ruby-value">:on_delete</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">fklod_map</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:on_delete</span>]],
<span class="line-num">629</span>         <span class="ruby-value">:deferrable</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">row</span>[<span class="ruby-value">:deferrable</span>],
<span class="line-num">630</span>         <span class="ruby-value">:table</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">schema</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:schema</span>]), <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>])) <span class="ruby-operator">:</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>]),
<span class="line-num">631</span>       }
<span class="line-num">632</span> 
<span class="line-num">633</span>       <span class="ruby-keyword">unless</span> <span class="ruby-identifier">schema</span>
<span class="line-num">634</span>         <span class="ruby-comment"># If not combining schema information into the :table entry</span>
<span class="line-num">635</span>         <span class="ruby-comment"># include it as a separate entry.</span>
<span class="line-num">636</span>         <span class="ruby-identifier">entry</span>[<span class="ruby-value">:schema</span>] = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:schema</span>])
<span class="line-num">637</span>       <span class="ruby-keyword">end</span>
<span class="line-num">638</span>     <span class="ruby-keyword">end</span>
<span class="line-num">639</span>   <span class="ruby-keyword">end</span>
<span class="line-num">640</span> 
<span class="line-num">641</span>   <span class="ruby-identifier">h</span>.<span class="ruby-identifier">values</span>
<span class="line-num">642</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-freeze'>
<a name='method-i-freeze'></a>
<div class='synopsis'>
<span class='name'>freeze</span><span class='arguments'>()</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-freeze-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-freeze-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">644</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>
<span class="line-num">645</span>   <span class="ruby-identifier">server_version</span>
<span class="line-num">646</span>   <span class="ruby-identifier">supports_prepared_transactions?</span>
<span class="line-num">647</span>   <span class="ruby-ivar">@conversion_procs</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">648</span>   <span class="ruby-keyword">super</span>
<span class="line-num">649</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-indexes'>
<a name='method-i-indexes'></a>
<div class='synopsis'>
<span class='name'>indexes</span><span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Use the pg_* system tables to determine indexes on a table</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-indexes-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-indexes-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">652</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">indexes</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">653</span>   <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>
<span class="line-num">654</span>   <span class="ruby-identifier">oid</span> = <span class="ruby-identifier">regclass_oid</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">655</span> 
<span class="line-num">656</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90500</span>
<span class="line-num">657</span>     <span class="ruby-identifier">order</span> = [<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:indc</span>][<span class="ruby-value">:relname</span>], <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-value">:array_position</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:ind</span>][<span class="ruby-value">:indkey</span>], <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att</span>][<span class="ruby-value">:attnum</span>])]
<span class="line-num">658</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">659</span>   <span class="ruby-keyword">else</span>
<span class="line-num">660</span>     <span class="ruby-identifier">range</span> = <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">32</span>
<span class="line-num">661</span>     <span class="ruby-identifier">order</span> = [<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:indc</span>][<span class="ruby-value">:relname</span>], <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">CaseExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:ind</span>][<span class="ruby-value">:indkey</span>], [<span class="ruby-identifier">x</span>]), <span class="ruby-identifier">x</span>]}, <span class="ruby-value">32</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:att</span>][<span class="ruby-value">:attnum</span>])]
<span class="line-num">662</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">663</span>   <span class="ruby-keyword">end</span>
<span class="line-num">664</span> 
<span class="line-num">665</span>   <span class="ruby-identifier">attnums</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Function</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:ANY</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:ind</span>][<span class="ruby-value">:indkey</span>])
<span class="line-num">666</span> 
<span class="line-num">667</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">metadata_dataset</span>.
<span class="line-num">668</span>     <span class="ruby-identifier">from</span>{<span class="ruby-identifier">pg_class</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:tab</span>)}.
<span class="line-num">669</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_index</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:ind</span>), <span class="ruby-value">:indrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:oid</span>).
<span class="line-num">670</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_class</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:indc</span>), <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:indexrelid</span>).
<span class="line-num">671</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_attribute</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:att</span>), <span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:tab</span>][<span class="ruby-value">:oid</span>], <span class="ruby-value">:attnum</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">attnums</span>).
<span class="line-num">672</span>     <span class="ruby-identifier">left_join</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:pg_constraint</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:con</span>), <span class="ruby-value">:conname</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:indc</span>][<span class="ruby-value">:relname</span>]).
<span class="line-num">673</span>     <span class="ruby-identifier">where</span>{{
<span class="line-num">674</span>       <span class="ruby-identifier">indc</span>[<span class="ruby-value">:relkind</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;i&#39;</span>,
<span class="line-num">675</span>       <span class="ruby-identifier">ind</span>[<span class="ruby-value">:indisprimary</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-keyword">false</span>,
<span class="line-num">676</span>       <span class="ruby-value">:indexprs</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>,
<span class="line-num">677</span>       <span class="ruby-value">:indisvalid</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>,
<span class="line-num">678</span>       <span class="ruby-identifier">tab</span>[<span class="ruby-value">:oid</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-identifier">oid</span>}}.
<span class="line-num">679</span>     <span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">order</span>).
<span class="line-num">680</span>     <span class="ruby-identifier">select</span>{[<span class="ruby-identifier">indc</span>[<span class="ruby-value">:relname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:name</span>), <span class="ruby-identifier">ind</span>[<span class="ruby-value">:indisunique</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:unique</span>), <span class="ruby-identifier">att</span>[<span class="ruby-value">:attname</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:column</span>), <span class="ruby-identifier">con</span>[<span class="ruby-value">:condeferrable</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:deferrable</span>)]}
<span class="line-num">681</span> 
<span class="line-num">682</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:indpred</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:include_partial</span>]
<span class="line-num">683</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">684</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:indisready</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">80300</span>
<span class="line-num">685</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:indislive</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90300</span>
<span class="line-num">686</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">687</span> 
<span class="line-num">688</span>   <span class="ruby-identifier">indexes</span> = {}
<span class="line-num">689</span>   <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
<span class="line-num">690</span>     <span class="ruby-identifier">i</span> = <span class="ruby-identifier">indexes</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:name</span>])] <span class="ruby-operator">||=</span> {<span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span>[], <span class="ruby-value">:unique</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">r</span>[<span class="ruby-value">:unique</span>], <span class="ruby-value">:deferrable</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">r</span>[<span class="ruby-value">:deferrable</span>]}
<span class="line-num">691</span>     <span class="ruby-identifier">i</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:column</span>])
<span class="line-num">692</span>   <span class="ruby-keyword">end</span>
<span class="line-num">693</span>   <span class="ruby-identifier">indexes</span>
<span class="line-num">694</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-locks'>
<a name='method-i-locks'></a>
<div class='synopsis'>
<span class='name'>locks</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p><a href="Dataset.html"><code>Dataset</code></a> containing all current database locks</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-locks-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-locks-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">697</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">locks</span>
<span class="line-num">698</span>   <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_class</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_locks</span>, <span class="ruby-value">:relation</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:relfilenode</span>).<span class="ruby-identifier">select</span>{[<span class="ruby-identifier">pg_class</span>[<span class="ruby-value">:relname</span>], <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">ColumnAll</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:pg_locks</span>)]}
<span class="line-num">699</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-notify'>
<a name='method-i-notify'></a>
<div class='synopsis'>
<span class='name'>notify</span><span class='arguments'>(channel, opts=OPTS)</span>

</div>
<div class='description'>

<p>Notifies the given channel.  See the PostgreSQL NOTIFY documentation. Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:payload </td><td>
<p>The payload string to use for the NOTIFY statement.  Only supported in PostgreSQL 9.0+.</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>The server to which to send the NOTIFY statement, if the sharding support is being used.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-notify-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-notify-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">707</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">notify</span>(<span class="ruby-identifier">channel</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">708</span>   <span class="ruby-identifier">sql</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>
<span class="line-num">709</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;NOTIFY &quot;</span>
<span class="line-num">710</span>   <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:identifier_append</span>, <span class="ruby-identifier">sql</span>, <span class="ruby-identifier">channel</span>)
<span class="line-num">711</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">payload</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:payload</span>]
<span class="line-num">712</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;, &quot;</span>
<span class="line-num">713</span>     <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">to_s</span>)
<span class="line-num">714</span>   <span class="ruby-keyword">end</span>
<span class="line-num">715</span>   <span class="ruby-identifier">execute_ddl</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">716</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-primary_key'>
<a name='method-i-primary_key'></a>
<div class='synopsis'>
<span class='name'>primary_key</span><span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return primary key for the given table.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-primary_key-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-primary_key-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">719</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_key</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">720</span>   <span class="ruby-identifier">quoted_table</span> = <span class="ruby-identifier">quote_schema_table</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">721</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@primary_keys</span>[<span class="ruby-identifier">quoted_table</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@primary_keys</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">quoted_table</span>)}
<span class="line-num">722</span>   <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_PK_SQL} AND pg_class.oid = #{literal(regclass_oid(table, opts))}&quot;</span>
<span class="line-num">723</span>   <span class="ruby-identifier">value</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_value</span>
<span class="line-num">724</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_keys</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}
<span class="line-num">725</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-primary_key_sequence'>
<a name='method-i-primary_key_sequence'></a>
<div class='synopsis'>
<span class='name'>primary_key_sequence</span><span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return the sequence providing the default for the primary key for the given table.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-primary_key_sequence-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-primary_key_sequence-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">728</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_key_sequence</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">729</span>   <span class="ruby-identifier">quoted_table</span> = <span class="ruby-identifier">quote_schema_table</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">730</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@primary_key_sequences</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">quoted_table</span>)}
<span class="line-num">731</span>   <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_SERIAL_SEQUENCE_SQL} AND t.oid = #{literal(regclass_oid(table, opts))}&quot;</span>
<span class="line-num">732</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">pks</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_record</span>
<span class="line-num">733</span>     <span class="ruby-identifier">value</span> = <span class="ruby-identifier">literal</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:schema</span>], <span class="ruby-identifier">pks</span>[<span class="ruby-value">:sequence</span>]))
<span class="line-num">734</span>     <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}
<span class="line-num">735</span>   <span class="ruby-keyword">else</span>
<span class="line-num">736</span>     <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;#{SELECT_CUSTOM_SEQUENCE_SQL} AND t.oid = #{literal(regclass_oid(table, opts))}&quot;</span>
<span class="line-num">737</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">pks</span> = <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">single_record</span>
<span class="line-num">738</span>       <span class="ruby-identifier">value</span> = <span class="ruby-identifier">literal</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:schema</span>], <span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pks</span>[<span class="ruby-value">:sequence</span>])))
<span class="line-num">739</span>       <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_key_sequences</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}
<span class="line-num">740</span>     <span class="ruby-keyword">end</span>
<span class="line-num">741</span>   <span class="ruby-keyword">end</span>
<span class="line-num">742</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-refresh_view'>
<a name='method-i-refresh_view'></a>
<div class='synopsis'>
<span class='name'>refresh_view</span><span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Refresh the materialized view with the given name.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">refresh_view</span>(<span class="ruby-value">:items_view</span>)
<span class="ruby-comment"># REFRESH MATERIALIZED VIEW items_view</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">refresh_view</span>(<span class="ruby-value">:items_view</span>, <span class="ruby-value">:concurrently</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)
<span class="ruby-comment"># REFRESH MATERIALIZED VIEW CONCURRENTLY items_view</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-refresh_view-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-refresh_view-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">750</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">refresh_view</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">751</span>   <span class="ruby-identifier">run</span> <span class="ruby-node">&quot;REFRESH MATERIALIZED VIEW#{&#39; CONCURRENTLY&#39; if opts[:concurrently]} #{quote_schema_table(name)}&quot;</span>
<span class="line-num">752</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-reset_primary_key_sequence'>
<a name='method-i-reset_primary_key_sequence'></a>
<div class='synopsis'>
<span class='name'>reset_primary_key_sequence</span><span class='arguments'>(table)</span>

</div>
<div class='description'>

<p>Reset the primary key sequence for the given table, basing it on the maximum current value of the table’s primary key.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-reset_primary_key_sequence-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-reset_primary_key_sequence-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">756</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reset_primary_key_sequence</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">757</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">seq</span> = <span class="ruby-identifier">primary_key_sequence</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">758</span>   <span class="ruby-identifier">pk</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">primary_key</span>(<span class="ruby-identifier">table</span>))
<span class="line-num">759</span>   <span class="ruby-identifier">db</span> = <span class="ruby-keyword">self</span>
<span class="line-num">760</span>   <span class="ruby-identifier">s</span>, <span class="ruby-identifier">t</span> = <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">761</span>   <span class="ruby-identifier">table</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">t</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>
<span class="line-num">762</span> 
<span class="line-num">763</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">100000</span>
<span class="line-num">764</span>     <span class="ruby-identifier">seq_ds</span> = <span class="ruby-identifier">metadata_dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_sequence</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:seqrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">regclass_oid</span>(<span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">seq</span>)))
<span class="line-num">765</span>     <span class="ruby-identifier">increment_by</span> = <span class="ruby-value">:seqincrement</span>
<span class="line-num">766</span>     <span class="ruby-identifier">min_value</span> = <span class="ruby-value">:seqmin</span>
<span class="line-num">767</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">768</span>   <span class="ruby-keyword">else</span>
<span class="line-num">769</span>     <span class="ruby-identifier">seq_ds</span> = <span class="ruby-identifier">metadata_dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">seq</span>))
<span class="line-num">770</span>     <span class="ruby-identifier">increment_by</span> = <span class="ruby-value">:increment_by</span>
<span class="line-num">771</span>     <span class="ruby-identifier">min_value</span> = <span class="ruby-value">:min_value</span>
<span class="line-num">772</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">773</span>   <span class="ruby-keyword">end</span>
<span class="line-num">774</span> 
<span class="line-num">775</span>   <span class="ruby-identifier">get</span>{<span class="ruby-identifier">setval</span>(<span class="ruby-identifier">seq</span>, <span class="ruby-identifier">db</span>[<span class="ruby-identifier">table</span>].<span class="ruby-identifier">select</span>(<span class="ruby-identifier">coalesce</span>(<span class="ruby-identifier">max</span>(<span class="ruby-identifier">pk</span>)<span class="ruby-operator">+</span><span class="ruby-identifier">seq_ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">increment_by</span>), <span class="ruby-identifier">seq_ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">min_value</span>))), <span class="ruby-keyword">false</span>)}
<span class="line-num">776</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-rollback_prepared_transaction'>
<a name='method-i-rollback_prepared_transaction'></a>
<div class='synopsis'>
<span class='name'>rollback_prepared_transaction</span><span class='arguments'>(transaction_id, opts=OPTS)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-rollback_prepared_transaction-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-rollback_prepared_transaction-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">778</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rollback_prepared_transaction</span>(<span class="ruby-identifier">transaction_id</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">779</span>   <span class="ruby-identifier">run</span>(<span class="ruby-node">&quot;ROLLBACK PREPARED #{literal(transaction_id)}&quot;</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">780</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-serial_primary_key_options'>
<a name='method-i-serial_primary_key_options'></a>
<div class='synopsis'>
<span class='name'>serial_primary_key_options</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL uses SERIAL psuedo-type instead of AUTOINCREMENT for managing incrementing primary keys.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-serial_primary_key_options-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-serial_primary_key_options-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">784</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">serial_primary_key_options</span>
<span class="line-num">785</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">786</span>   <span class="ruby-identifier">auto_increment_key</span> = <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">100002</span> <span class="ruby-operator">?</span> <span class="ruby-value">:identity</span> <span class="ruby-operator">:</span> <span class="ruby-value">:serial</span>
<span class="line-num">787</span>   <span class="ruby-comment"># :nocov:</span>
<span class="line-num">788</span>   {<span class="ruby-value">:primary_key</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">auto_increment_key</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:type</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">Integer</span>}
<span class="line-num">789</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-server_version'>
<a name='method-i-server_version'></a>
<div class='synopsis'>
<span class='name'>server_version</span><span class='arguments'>(server=nil)</span>

</div>
<div class='description'>

<p>The version of the PostgreSQL server, used for determining capability.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-server_version-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-server_version-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">792</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">server_version</span>(<span class="ruby-identifier">server</span>=<span class="ruby-keyword">nil</span>)
<span class="line-num">793</span>   <span class="ruby-keyword">return</span> <span class="ruby-ivar">@server_version</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@server_version</span>
<span class="line-num">794</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">dataset</span>
<span class="line-num">795</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">server</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">server</span>
<span class="line-num">796</span>   <span class="ruby-ivar">@server_version</span> = <span class="ruby-identifier">swallow_database_error</span>{<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">with_sql</span>(<span class="ruby-string">&quot;SELECT CAST(current_setting(&#39;server_version_num&#39;) AS integer) AS v&quot;</span>).<span class="ruby-identifier">single_value</span>} <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
<span class="line-num">797</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_create_table_if_not_exists-3F'>
<a name='method-i-supports_create_table_if_not_exists-3F'></a>
<div class='synopsis'>
<span class='name'>supports_create_table_if_not_exists?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports CREATE TABLE IF NOT EXISTS on 9.1+</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_create_table_if_not_exists-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_create_table_if_not_exists-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">800</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_create_table_if_not_exists?</span>
<span class="line-num">801</span>   <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90100</span>
<span class="line-num">802</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_deferrable_constraints-3F'>
<a name='method-i-supports_deferrable_constraints-3F'></a>
<div class='synopsis'>
<span class='name'>supports_deferrable_constraints?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL 9.0+ supports some types of deferrable constraints beyond foreign key constraints.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_deferrable_constraints-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_deferrable_constraints-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">805</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_deferrable_constraints?</span>
<span class="line-num">806</span>   <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90000</span>
<span class="line-num">807</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_deferrable_foreign_key_constraints-3F'>
<a name='method-i-supports_deferrable_foreign_key_constraints-3F'></a>
<div class='synopsis'>
<span class='name'>supports_deferrable_foreign_key_constraints?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports deferrable foreign key constraints.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_deferrable_foreign_key_constraints-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_deferrable_foreign_key_constraints-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">810</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_deferrable_foreign_key_constraints?</span>
<span class="line-num">811</span>   <span class="ruby-keyword">true</span>
<span class="line-num">812</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_drop_table_if_exists-3F'>
<a name='method-i-supports_drop_table_if_exists-3F'></a>
<div class='synopsis'>
<span class='name'>supports_drop_table_if_exists?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports DROP TABLE IF EXISTS</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_drop_table_if_exists-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_drop_table_if_exists-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">815</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_drop_table_if_exists?</span>
<span class="line-num">816</span>   <span class="ruby-keyword">true</span>
<span class="line-num">817</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_partial_indexes-3F'>
<a name='method-i-supports_partial_indexes-3F'></a>
<div class='synopsis'>
<span class='name'>supports_partial_indexes?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports partial indexes.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_partial_indexes-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_partial_indexes-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">820</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_partial_indexes?</span>
<span class="line-num">821</span>   <span class="ruby-keyword">true</span>
<span class="line-num">822</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_prepared_transactions-3F'>
<a name='method-i-supports_prepared_transactions-3F'></a>
<div class='synopsis'>
<span class='name'>supports_prepared_transactions?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports prepared transactions (two-phase commit) if max_prepared_transactions is greater than 0.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_prepared_transactions-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_prepared_transactions-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">831</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_prepared_transactions?</span>
<span class="line-num">832</span>   <span class="ruby-keyword">return</span> <span class="ruby-ivar">@supports_prepared_transactions</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@supports_prepared_transactions</span>)
<span class="line-num">833</span>   <span class="ruby-ivar">@supports_prepared_transactions</span> = <span class="ruby-keyword">self</span>[<span class="ruby-string">&#39;SHOW max_prepared_transactions&#39;</span>].<span class="ruby-identifier">get</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="line-num">834</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_savepoints-3F'>
<a name='method-i-supports_savepoints-3F'></a>
<div class='synopsis'>
<span class='name'>supports_savepoints?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports savepoints</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_savepoints-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_savepoints-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">837</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_savepoints?</span>
<span class="line-num">838</span>   <span class="ruby-keyword">true</span>
<span class="line-num">839</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_transaction_isolation_levels-3F'>
<a name='method-i-supports_transaction_isolation_levels-3F'></a>
<div class='synopsis'>
<span class='name'>supports_transaction_isolation_levels?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports transaction isolation levels</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_transaction_isolation_levels-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_transaction_isolation_levels-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">842</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_transaction_isolation_levels?</span>
<span class="line-num">843</span>   <span class="ruby-keyword">true</span>
<span class="line-num">844</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_transactional_ddl-3F'>
<a name='method-i-supports_transactional_ddl-3F'></a>
<div class='synopsis'>
<span class='name'>supports_transactional_ddl?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL supports transaction DDL statements.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_transactional_ddl-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_transactional_ddl-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">847</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_transactional_ddl?</span>
<span class="line-num">848</span>   <span class="ruby-keyword">true</span>
<span class="line-num">849</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_trigger_conditions-3F'>
<a name='method-i-supports_trigger_conditions-3F'></a>
<div class='synopsis'>
<span class='name'>supports_trigger_conditions?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>PostgreSQL 9.0+ supports trigger conditions.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_trigger_conditions-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_trigger_conditions-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">825</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_trigger_conditions?</span>
<span class="line-num">826</span>   <span class="ruby-identifier">server_version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">90000</span>
<span class="line-num">827</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-tables'>
<a name='method-i-tables'></a>
<div class='synopsis'>
<span class='name'>tables</span><span class='arguments'>(opts=OPTS, &block)</span>

</div>
<div class='description'>

<p>Array of symbols specifying table names in the current database. The dataset used is yielded to the block if one is provided, otherwise, an array of symbols of table names is returned.</p>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:qualify </td><td>
<p>Return the tables as Sequel::SQL::QualifiedIdentifier instances, using the schema the table is located in as the qualifier.</p>
</td></tr><tr><td class='label'>:schema </td><td>
<p>The schema to search</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>The server to use</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-tables-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-tables-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">860</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tables</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">861</span>   <span class="ruby-identifier">pg_class_relname</span>([<span class="ruby-string">&#39;r&#39;</span>, <span class="ruby-string">&#39;p&#39;</span>], <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">862</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-type_supported-3F'>
<a name='method-i-type_supported-3F'></a>
<div class='synopsis'>
<span class='name'>type_supported?</span><span class='arguments'>(type)</span>

</div>
<div class='description'>

<p>Check whether the given type name string/symbol (e.g. :hstore) is supported by the database.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-type_supported-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-type_supported-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">866</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">type_supported?</span>(<span class="ruby-identifier">type</span>)
<span class="line-num">867</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@supported_types</span>[<span class="ruby-identifier">type</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@supported_types</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">type</span>)}
<span class="line-num">868</span>   <span class="ruby-identifier">supported</span> = <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_type</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:typtype</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;b&#39;</span>, <span class="ruby-value">:typname</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="line-num">869</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@supported_types</span>[<span class="ruby-identifier">type</span>] = <span class="ruby-identifier">supported</span>}
<span class="line-num">870</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-values'>
<a name='method-i-values'></a>
<div class='synopsis'>
<span class='name'>values</span><span class='arguments'>(v)</span>

</div>
<div class='description'>

<p>Creates a dataset that uses the VALUES clause:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">values</span>([[<span class="ruby-value">1</span>, <span class="ruby-value">2</span>], [<span class="ruby-value">3</span>, <span class="ruby-value">4</span>]])
<span class="ruby-comment"># VALUES ((1, 2), (3, 4))</span>

<span class="ruby-constant">DB</span>.<span class="ruby-identifier">values</span>([[<span class="ruby-value">1</span>, <span class="ruby-value">2</span>], [<span class="ruby-value">3</span>, <span class="ruby-value">4</span>]]).<span class="ruby-identifier">order</span>(<span class="ruby-value">:column2</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-value">1</span>, <span class="ruby-value">1</span>)
<span class="ruby-comment"># VALUES ((1, 2), (3, 4)) ORDER BY column2 LIMIT 1 OFFSET 1</span>
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-values-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-values-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">879</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">values</span>(<span class="ruby-identifier">v</span>)
<span class="line-num">880</span>   <span class="ruby-ivar">@default_dataset</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-value">:values</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">v</span>)
<span class="line-num">881</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-views'>
<a name='method-i-views'></a>
<div class='synopsis'>
<span class='name'>views</span><span class='arguments'>(opts=OPTS)</span>

</div>
<div class='description'>

<p>Array of symbols specifying view names in the current database.</p>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:materialized </td><td>
<p>Return materialized views</p>
</td></tr><tr><td class='label'>:qualify </td><td>
<p>Return the views as Sequel::SQL::QualifiedIdentifier instances, using the schema the view is located in as the qualifier.</p>
</td></tr><tr><td class='label'>:schema </td><td>
<p>The schema to search</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>The server to use</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-views-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-views-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/postgres.rb</span>
<span class="line-num">891</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">views</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">892</span>   <span class="ruby-identifier">relkind</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:materialized</span>] <span class="ruby-operator">?</span> <span class="ruby-string">&#39;m&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;v&#39;</span>
<span class="line-num">893</span>   <span class="ruby-identifier">pg_class_relname</span>(<span class="ruby-identifier">relkind</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">894</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
