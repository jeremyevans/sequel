<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Sequel::ShardedThreadedConnectionPool</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      function popupCode(url) {
        window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
      }
      
      function toggleCode(id) {
        var code = document.getElementById(id)
      
        code.style.display = code.style.display != 'block' ? 'block' : 'none'
        return true
      }
      
      // Make codeblocks hidden by default
      document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Sequel::ShardedThreadedConnectionPool
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../files/lib/sequel/connection_pool/sharded_threaded_rb.html">lib/sequel/connection_pool/sharded_threaded.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Superclass:
          <strong><a target="docwin" href="ThreadedConnectionPool.html">ThreadedConnectionPool</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>The slowest and most advanced connection, dealing with both multi-threaded
            access and configurations with multiple shards/servers.</p>
            
            <p>In addition, this pool subclass also handles scheduling in-use connections
            to be removed from the pool when they are returned to it.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-new">new</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#method-i-add_servers">add_servers</a></li>
              <li><a target="docwin" href="#method-i-all_connections">all_connections</a></li>
              <li><a target="docwin" href="#method-i-allocated">allocated</a></li>
              <li><a target="docwin" href="#method-i-available_connections">available_connections</a></li>
              <li><a target="docwin" href="#method-i-disconnect">disconnect</a></li>
              <li><a target="docwin" href="#method-i-hold">hold</a></li>
              <li><a target="docwin" href="#method-i-pool_type">pool_type</a></li>
              <li><a target="docwin" href="#method-i-remove_servers">remove_servers</a></li>
              <li><a target="docwin" href="#method-i-servers">servers</a></li>
              <li><a target="docwin" href="#method-i-size">size</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-new'>
                <a name='method-c-new'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(db, opts = OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>The following additional options are respected:</p>
                  <table class="rdoc-list note-list"><tbody><tr><td class='label'>:servers </td><td>
                  <p>A hash of servers to use.  Keys should be symbols.  If not present, will
                  use a single :default server.</p>
                  </td></tr><tr><td class='label'>:servers_hash </td><td>
                  <p>The base hash to use for the servers.  By default, <a
                  href="../Sequel.html">Sequel</a> uses Hash.new(:default).  You can use a
                  hash with a default proc that raises an error if you want to catch all
                  cases where a nonexistent server is used.</p>
                  </td></tr></tbody></table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-new-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-new-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 17</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">db</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">super</span>&#x000A;  <span class="ruby-ivar">@available_connections</span> = {}&#x000A;  <span class="ruby-ivar">@connections_to_remove</span> = []&#x000A;  <span class="ruby-ivar">@servers</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:servers_hash</span>, <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:default</span>))&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-constant">USE_WAITER</span>&#x000A;    <span class="ruby-ivar">@waiter</span> = <span class="ruby-keyword">nil</span>&#x000A;    <span class="ruby-ivar">@waiters</span> = {}&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">add_servers</span>([<span class="ruby-value">:default</span>])&#x000A;  <span class="ruby-identifier">add_servers</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:servers</span>].<span class="ruby-identifier">keys</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:servers</span>]&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-add_servers'>
                <a name='method-i-add_servers'></a>
                <div class='synopsis'>
                  <span class='name'>add_servers</span>
                  <span class='arguments'>(servers)</span>
                </div>
                <div class='description'>
                  
                  <p>Adds new servers to the connection pool. Primarily used in conjunction with
                  master/slave or shard configurations. Allows for dynamic expansion of the
                  potential slaves/shards at runtime. servers argument should be an array of
                  symbols.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-add_servers-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-add_servers-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 35</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_servers</span>(<span class="ruby-identifier">servers</span>)&#x000A;  <span class="ruby-identifier">sync</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">server</span>)&#x000A;        <span class="ruby-ivar">@servers</span>[<span class="ruby-identifier">server</span>] = <span class="ruby-identifier">server</span>&#x000A;        <span class="ruby-ivar">@available_connections</span>[<span class="ruby-identifier">server</span>] = []&#x000A;        <span class="ruby-ivar">@allocated</span>[<span class="ruby-identifier">server</span>] = {}&#x000A;        <span class="ruby-ivar">@waiters</span>[<span class="ruby-identifier">server</span>] = <span class="ruby-constant">ConditionVariable</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">USE_WAITER</span>&#x000A;      <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-all_connections'>
                <a name='method-i-all_connections'></a>
                <div class='synopsis'>
                  <span class='name'>all_connections</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Yield all of the available connections, and the ones currently allocated to
                  this thread.  This will not yield connections currently allocated to other
                  threads, as it is not safe to operate on them.  This holds the mutex while
                  it is yielding all of the connections, which means that until the
                  method&#39;s block returns, the pool is locked.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-all_connections-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-all_connections-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 60</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_connections</span>&#x000A;  <span class="ruby-identifier">t</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>&#x000A;  <span class="ruby-identifier">sync</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-ivar">@allocated</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">threads</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">threads</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">thread</span>, <span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>&#x000A;        <span class="ruby-keyword">yield</span> <span class="ruby-identifier">conn</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">thread</span>&#x000A;      <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-ivar">@available_connections</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">c</span>}}&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-allocated'>
                <a name='method-i-allocated'></a>
                <div class='synopsis'>
                  <span class='name'>allocated</span>
                  <span class='arguments'>(server=:default)</span>
                </div>
                <div class='description'>
                  
                  <p>A hash of connections currently being used for the given server, key is the
                  Thread, value is the connection.  Nonexistent servers will return nil. 
                  Treat this as read only, do not modify the resulting object.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-allocated-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-allocated-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 51</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">allocated</span>(<span class="ruby-identifier">server</span>=<span class="ruby-value">:default</span>)&#x000A;  <span class="ruby-ivar">@allocated</span>[<span class="ruby-identifier">server</span>]&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-available_connections'>
                <a name='method-i-available_connections'></a>
                <div class='synopsis'>
                  <span class='name'>available_connections</span>
                  <span class='arguments'>(server=:default)</span>
                </div>
                <div class='description'>
                  
                  <p>An array of connections opened but not currently used, for the given
                  server. Nonexistent servers will return nil. Treat this as read only, do
                  not modify the resulting object.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-available_connections-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-available_connections-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 75</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">available_connections</span>(<span class="ruby-identifier">server</span>=<span class="ruby-value">:default</span>)&#x000A;  <span class="ruby-ivar">@available_connections</span>[<span class="ruby-identifier">server</span>]&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-disconnect'>
                <a name='method-i-disconnect'></a>
                <div class='synopsis'>
                  <span class='name'>disconnect</span>
                  <span class='arguments'>(opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Removes all connections currently available on all servers, optionally
                  yielding each connection to the given block. This method has the effect of 
                  disconnecting from the database, assuming that no connections are currently
                  being used.  If connections are being used, they are scheduled to be
                  disconnected as soon as they are returned to the pool.</p>
                  
                  <p>Once a connection is requested using <a
                  href="ShardedThreadedConnectionPool.html#method-i-hold">hold</a>, the
                  connection pool creates new connections to the database. Options:</p>
                  <table class="rdoc-list note-list"><tbody><tr><td class='label'>:server </td><td>
                  <p>Should be a symbol specifing the server to disconnect from, or an array of
                  symbols to specify multiple servers.</p>
                  </td></tr></tbody></table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-disconnect-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-disconnect-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 97</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">disconnect</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>]) <span class="ruby-operator">:</span> <span class="ruby-identifier">sync</span>{<span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">keys</span>}).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">conns</span> = <span class="ruby-identifier">sync</span>{<span class="ruby-identifier">disconnect_server_connections</span>(<span class="ruby-identifier">s</span>)}&#x000A;      <span class="ruby-identifier">disconnect_connections</span>(<span class="ruby-identifier">conns</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-hold'>
                <a name='method-i-hold'></a>
                <div class='synopsis'>
                  <span class='name'>hold</span>
                  <span class='arguments'>(server=:default)</span>
                </div>
                <div class='description'>
                  
                  <p>Chooses the first available connection to the given server, or if none are
                  available, creates a new connection.  Passes the connection to the supplied
                  block:</p>
                  
                  <pre class="ruby"><span class="ruby-identifier">pool</span>.<span class="ruby-identifier">hold</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-string">&#39;DROP TABLE posts&#39;</span>)}</pre>
                  
                  <p>Pool#hold is re-entrant, meaning it can be called recursively in the same
                  thread without blocking.</p>
                  
                  <p>If no connection is immediately available and the pool is already using the
                  maximum number of connections, Pool#hold will block until a connection is
                  available or the timeout expires.  If the timeout expires before a
                  connection can be acquired, a Sequel::PoolTimeout is  raised.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-hold-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-hold-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 119</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">hold</span>(<span class="ruby-identifier">server</span>=<span class="ruby-value">:default</span>)&#x000A;  <span class="ruby-identifier">server</span> = <span class="ruby-identifier">pick_server</span>(<span class="ruby-identifier">server</span>)&#x000A;  <span class="ruby-identifier">t</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">conn</span> = <span class="ruby-identifier">owned_connection</span>(<span class="ruby-identifier">t</span>, <span class="ruby-identifier">server</span>)&#x000A;    <span class="ruby-keyword">return</span> <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">conn</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">begin</span>&#x000A;    <span class="ruby-identifier">conn</span> = <span class="ruby-identifier">acquire</span>(<span class="ruby-identifier">t</span>, <span class="ruby-identifier">server</span>)&#x000A;    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">conn</span>&#x000A;  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">DatabaseDisconnectError</span>, <span class="ruby-operator">*</span><span class="ruby-ivar">@error_classes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;    <span class="ruby-identifier">sync</span>{<span class="ruby-ivar">@connections_to_remove</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">conn</span>} <span class="ruby-keyword">if</span> <span class="ruby-identifier">conn</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">disconnect_error?</span>(<span class="ruby-identifier">e</span>)&#x000A;    <span class="ruby-identifier">raise</span>&#x000A;  <span class="ruby-keyword">ensure</span>&#x000A;    <span class="ruby-identifier">sync</span>{<span class="ruby-identifier">release</span>(<span class="ruby-identifier">t</span>, <span class="ruby-identifier">conn</span>, <span class="ruby-identifier">server</span>)} <span class="ruby-keyword">if</span> <span class="ruby-identifier">conn</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-pool_type'>
                <a name='method-i-pool_type'></a>
                <div class='synopsis'>
                  <span class='name'>pool_type</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-pool_type-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-pool_type-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 165</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">pool_type</span>&#x000A;  <span class="ruby-value">:sharded_threaded</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-remove_servers'>
                <a name='method-i-remove_servers'></a>
                <div class='synopsis'>
                  <span class='name'>remove_servers</span>
                  <span class='arguments'>(servers)</span>
                </div>
                <div class='description'>
                  
                  <p>Remove servers from the connection pool. Primarily used in conjunction with
                  master/slave or shard configurations.  Similar to disconnecting from all
                  given servers, except that after it is used, future requests for the server
                  will use the :default server instead.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-remove_servers-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-remove_servers-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 140</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_servers</span>(<span class="ruby-identifier">servers</span>)&#x000A;  <span class="ruby-identifier">conns</span> = <span class="ruby-keyword">nil</span>&#x000A;  <span class="ruby-identifier">sync</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;cannot remove default server&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">:default</span>)&#x000A;    <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">server</span>)&#x000A;        <span class="ruby-identifier">conns</span> = <span class="ruby-identifier">disconnect_server_connections</span>(<span class="ruby-identifier">server</span>)&#x000A;        <span class="ruby-ivar">@waiters</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">USE_WAITER</span>&#x000A;        <span class="ruby-ivar">@available_connections</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">server</span>)&#x000A;        <span class="ruby-ivar">@allocated</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">server</span>)&#x000A;        <span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">server</span>)&#x000A;      <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">conns</span>&#x000A;    <span class="ruby-identifier">disconnect_connections</span>(<span class="ruby-identifier">conns</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-servers'>
                <a name='method-i-servers'></a>
                <div class='synopsis'>
                  <span class='name'>servers</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Return an array of symbols for servers in the connection pool.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-servers-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-servers-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 161</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">servers</span>&#x000A;  <span class="ruby-identifier">sync</span>{<span class="ruby-ivar">@servers</span>.<span class="ruby-identifier">keys</span>}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-size'>
                <a name='method-i-size'></a>
                <div class='synopsis'>
                  <span class='name'>size</span>
                  <span class='arguments'>(server=:default)</span>
                </div>
                <div class='description'>
                  
                  <p>The total number of connections opened for the given server, should be
                  equal to available_connections.length + allocated.length.  Nonexistent
                  servers will return the created count of the default server.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-size-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-size-source'><span class="ruby-comment"># File lib/sequel/connection_pool/sharded_threaded.rb, line 82</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">size</span>(<span class="ruby-identifier">server</span>=<span class="ruby-value">:default</span>)&#x000A;  <span class="ruby-identifier">server</span> = <span class="ruby-ivar">@servers</span>[<span class="ruby-identifier">server</span>]&#x000A;  <span class="ruby-ivar">@allocated</span>[<span class="ruby-identifier">server</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@available_connections</span>[<span class="ruby-identifier">server</span>].<span class="ruby-identifier">length</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
    </div>
  </body>
</html>
